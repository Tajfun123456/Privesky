<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D P콏칤v캩sky - MVP Prototyp (s Widgety)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://widget.packeta.com/v6/www/js/library.js"></script>
    <script src="https://www.balikovna.cz/widget/vyber-mist-v1.js"></script>

    <!-- NOVINKA: P콏id치na knihovna three.js pro anal칳zu 3D model콢 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- NOVINKA: P콏id치n STLLoader pro three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>

    <style>
        /* Jednoduch칳 styl pro 'prose' (pro textov칳 obsah) */
        .prose {
            color: #333;
            line-height: 1.6;
        }
        .prose h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        .prose p {
            margin-bottom: 1.25em;
        }
        .prose ul {
            list-style-type: disc;
            padding-left: 1.5em;
            margin-bottom: 1.25em;
        }
        .prose li {
            margin-bottom: 0.5em;
        }
        /* Styl pro nahr치v치n칤 souboru */
        .file-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .file-upload-area:hover,
        .file-upload-area.drag-over {
            background-color: #f8fafc;
        }
    </style>
</head>
<body class="bg-white">
    <div id="root"></div>

    <script type="text/babel">
// --- TYPY A ROZHRAN칈 ---
// Pozn치mka: Vzhledem k tomu, 쬰 toto b캩쮂 v Babelu, pou쬴jeme `React.Component` atd.
// A typy definujeme pomoc칤 koment치콏콢 pro p콏ehlednost.

/*
type ProductType = 'fox' | 'dog';

interface Product {
  id: ProductType;
  name: string;
  subtitle: string;
  price: number;
  description: string;
  images: string[];
  reviews: Review[];
  details: {
    dimensions: string;
    material: string;
    colors: string;
  };
}

interface Review {
  id: string;
  author: string;
  rating: number;
  date: string;
  text: string;
}

// *** UPRAVENO: CartItem nyn칤 podporuje 'product' a 'custom' typy ***
interface CartItem {
  id: string; // M콢쬰 b칳t ProductType ('fox', 'dog') nebo unik치tn칤 ID pro zak치zkov칳 tisk
  quantity: number;
  type: 'product' | 'custom';
  // Detaily pouze pro 'custom' typ
  customDetails?: {
    name: string;
    price: number;
    fileName: string;
    volumeCm3: number; // Objem v cm^3
    material: string; // Vybran칳 materi치l (v캜etn캩 barvy)
    imageUrl: string; // Placeholder obr치zek
  };
}
*/

// *** UPRAVENO: P콏id치na str치nka 'customPrint' ***
/* type Page = 'home' | 'product' | 'contact' | 'cart' | 'checkout' | 'printing' | 'confirmation' | 'customPrint';

interface ShippingOption {
  id: string;
  name: string;
  price: number;
  icon: React.ReactNode;
  type: 'address' | 'pickup';
}

interface PickupPoint {
  id: string;
  name: string;
  street?: string;
  city?: string;
  zip?: string;
}

interface ShippingAddress {
  city: string;
  zip: string;
  street: string;
  number: string;
}

interface ContactDetails {
    email: string;
    phone: string;
    address: ShippingAddress | null; // M콢쬰 b칳t null pokud je pickup
}

interface OrderConfirmation {
    orderId: string;
    contact: ContactDetails;
    order: {
        items: CartItem[]; // Nyn칤 obsahuje nov칠 CartItem objekty
        subtotal: number;
        shippingCost: number;
        total: number;
    };
    shippingOption: ShippingOption | undefined;
    pickupPoint: PickupPoint | undefined;
}

interface AppContextType {
  currentPage: Page;
  currentProduct: ProductType;
  cart: CartItem[];
  shippingOptionId: string | null;
  selectedPickupPoint: PickupPoint | null;
  shippingAddress: ShippingAddress;
  toastMessage: string | null;
  orderConfirmation: OrderConfirmation | null;
  isSubmitting: boolean;
  navigateTo: (page: Page, productId?: ProductType) => void;
  addToCart: (productId: ProductType, quantity: number) => void;
  // *** NOVINKA: Funkce pro p콏id치n칤 zak치zkov칠ho tisku ***
  addCustomItemToCart: (item: CartItem) => void;
  updateCartItemQuantity: (itemId: string, newQuantity: number) => void;
  removeFromCart: (itemId: string) => void;
  clearCart: () => void;
  selectShippingOption: (optionId: string) => void;
  selectPickupPoint: (point: PickupPoint | null) => void;
  setShippingAddress: (address: Partial<ShippingAddress>) => void;
  showToast: (message: string) => void;
  clearToast: () => void;
  submitOrder: (contact: ContactDetails, order: any, shipping: any, pickup: any) => Promise<void>;
  totalCartItems: number;
  cartSubtotal: number;
  shippingCost: number;
  totalPrice: number;
}
*/

// --- KONSTANTY A MOCK DATA ---
const { useState, useContext, createContext, useMemo, useCallback, forwardRef, useEffect } = React;

const FREE_SHIPPING_THRESHOLD = 1000;
const DEFAULT_SHIPPING_COST = 50;

// Z치stupn칠 obr치zky
const IMAGES = {
  fox_les: "https://placehold.co/600x600/567d46/white?text=Li코ka+v+lese",
  fox_klice: "https://placehold.co/600x600/8c6a4f/white?text=Li코ka+na+kl칤캜칤ch",
  fox_batoh: "https://placehold.co/600x600/2d2d2d/white?text=Li코ka+na+batohu",
  dog_vanoce: "https://placehold.co/600x600/a67c00/white?text=Pes+V치noce",
  dog_batoh: "https://placehold.co/600x600/2d2d2d/white?text=Pes+na+batohu",
  dog_dvere: "https://placehold.co/600x600/8c6a4f/white?text=Pes+u+dve콏칤",
  printer_image: "https://placehold.co/400x300/e0e0e0/9ca3af?text=Bambu+Lab+P1S",
  filament_image: "https://placehold.co/400x300/e0e0e0/9ca3af?text=PLA+Filamenty",
  // *** NOVINKA: Obr치zky pro zak치zkov칳 tisk ***
  custom_print_hero: "https://placehold.co/1200x500/1a1a1a/white?text=V치코+N치pad,+N치코+Tisk",
  custom_print_placeholder: "https://placehold.co/200x200/e0e0e0/9ca3af?text=V치코+Model",
};

const PRODUCT_DATA = {
  fox: {
    id: 'fox',
    name: 'P콏칤v캩sek Li코ka',
    subtitle: 'Tri-Color',
    price: 59,
    description: 'Ikonick칳 li코캜칤 design s v칳razn칳mi barvami, ti코t캩n칳 modern칤 3D technologi칤. Lehk칳 a detailn칤 p콏칤v캩sek. Ide치ln칤 pro kl칤캜e nebo batoh.',
    images: [IMAGES.fox_les, IMAGES.fox_klice, IMAGES.fox_batoh, IMAGES.fox_les],
    reviews: [
      { id: 'r1', author: 'Anna K.', rating: 5, date: '15.2.2025', text: 'Perfektn칤 kvalita! P콏칤v캩sek je lehk칳, barvy jsou naprosto 쬴v칠 a detaily jsou neuv캩콏iteln칠. Nos칤m ho na batohu u m캩s칤c a vypad치 st치le jako nov칳.' },
      { id: 'r2', author: 'Lucie S.', rating: 4, date: '5.2.2025', text: 'Velmi roztomil칳 design a skv캩l칠 zpracov치n칤. Za 59 K캜 naprosto super!' },
      { id: 'r3', author: 'Martin V.', rating: 5, date: '1.2.2025', text: 'Jsem p콏ekvapen칳 kvalitou 3D tisku. Detaily jsou precizn칤 a materi치l je opravdu odoln칳.' },
    ],
    details: {
      dimensions: '6 칑 3,5 cm',
      material: 'Vysoce odoln칳 PLA filament',
      colors: '콯lut치, 캜erven치, 캜ern치, b칤l치',
    },
  },
  dog: {
    id: 'dog',
    name: 'P콏칤v캩sek Pes',
    subtitle: 'N캩meck칳 ov캜치k',
    price: 59,
    description: 'Obl칤ben칳 motiv psa, ti코t캩n칳 na 3D tisk치rn캩. Lehk칳 a detailn칤 p콏칤v캩sek. Ide치ln칤 pro kl칤캜e nebo batoh. Skv캩l칳 d치rek pro milovn칤ky ps콢.',
    images: [IMAGES.dog_vanoce, IMAGES.dog_batoh, IMAGES.dog_dvere, IMAGES.dog_vanoce],
    reviews: [
      { id: 'r4', author: 'Petr M.', rating: 5, date: '10.2.2025', text: 'Koupil jsem jako d치rek pro dceru a byla nad코en치! Materi치l je opravdu kvalitn칤 a odoln칳. Rozhodn캩 doporu캜uji.' },
      { id: 'r5', author: 'Jana K.', rating: 5, date: '8.2.2025', text: 'M치m n캩meck칠ho ov캜치ka a tento p콏칤v캩sek je prost캩 dokonal칳! P콏esn캩 zachycuje tu podobu.' },
      { id: 'r6', author: 'Tom치코 B.', rating: 5, date: '3.2.2025', text: 'Super cena, super kvalita. Koupil jsem si hned dva!' },
    ],
    details: {
      dimensions: '6 칑 3,5 cm',
      material: 'Vysoce odoln칳 PLA filament',
      colors: '캛ern치, b칤l치',
    },
  },
};

// *** NOVINKA: Seznam barev pro PLA ***
const PLA_COLORS = [
  { id: 'cerna', name: '캛ern치', hex: '#000000' },
  { id: 'bila', name: 'B칤l치', hex: '#FFFFFF' },
  { id: 'cervena', name: '캛erven치', hex: '#FF0000' },
  { id: 'modra', name: 'Modr치', hex: '#0000FF' },
  { id: 'zluta', name: '콯lut치', hex: '#FFFF00' },
  { id: 'zelena', name: 'Zelen치', hex: '#008000' },
  { id: 'duhova', name: 'Duhov치', hex: 'linear-gradient(to right, #E8141E, #F77F00, #FCF60C, #56A00E, #0077E1, #6200B3)' },
];

// --- IKONY (LUCIDE-REACT N츼HRADA) ---
// (Ikony z콢st치vaj칤 beze zm캩ny... p콏id치na IconCube)

const IconTruck = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11"/><path d="M14 9h7c.6 0 1 .4 1 1v9c0 .6-.4 1-1 1h-7l-2 2v-2z"/><path d="M10 6V4c0-.6-.4-1-1-1H4c-.6 0-1 .4-1 1v2"/><path d="M18 18.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"/><path d="M9 18.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"/>
  </svg>
);
const IconSearch = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
  </svg>
);
const IconUser = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
  </svg>
);
const IconShoppingBag = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>
  </svg>
);
const IconMinus = ({ size = 16, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <line x1="5" y1="12" x2="19" y2="12"/>
  </svg>
);
const IconPlus = ({ size = 16, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
  </svg>
);
const IconTrash = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
  </svg>
);
const IconPackage = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/>
  </svg>
);
const IconHome = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
  </svg>
);
const IconAward = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 17 17 23 15.79 13.88"/>
  </svg>
);
const IconPrinter = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/>
  </svg>
);
const IconMail = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
  </svg>
);
const IconSend = ({ size = 18, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
  </svg>
);
const IconMap = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/>
  </svg>
);
const IconFilter = ({ size = 16, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
  </svg>
);
const IconCheck = ({ size = 16, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <polyline points="20 6 9 17 4 12"/>
  </svg>
);
const IconStar = ({ size = 20, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
  </svg>
);
const IconLayers = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/>
  </svg>
);
const IconZap = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
  </svg>
);
const IconLeaf = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M11 20A7 7 0 0 1 4 13V8a5 5 0 0 1 10 0v5a7 7 0 0 1-7 7z"/><path d="M20 10a5 5 0 0 0-10 0v5a5 5 0 0 0 10 0z"/>
  </svg>
);
const IconChevronRight = ({ size = 16, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <polyline points="9 18 15 12 9 6"/>
  </svg>
);
const IconBox = ({ size = 16, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
  </svg>
);
const IconPost = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><path d="M3 9h18M12 14v-2.5M12 17v.01"/>
  </svg>
);
const IconAlza = ({ size = 24, className = "" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="12" cy="12" r="10" fill="#00A000"/>
  </svg>
);
const IconMapPin = ({ size = 16, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/>
  </svg>
);
const IconFacebook = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
  </svg>
);
const IconInstagram = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
  </svg>
);
const IconX = ({ size = 24, className = "" }) => (
 <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />
  </svg>
);
const IconCheckCircle = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
  </svg>
);
// *** NOVINKA: Ikona pro zak치zkov칳 tisk ***
const IconCube = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/>
  </svg>
);
const IconUploadCloud = ({ size = 24, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/>
  </svg>
);
const IconFile = ({ size = 24, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
        <polyline points="14 2 14 8 20 8" />
    </svg>
);
const IconLoader = ({ size = 24, className = "" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`${className} animate-spin`}>
        <line x1="12" y1="2" x2="12" y2="6" />
        <line x1="12" y1="18" x2="12" y2="22" />
        <line x1="4.93" y1="4.93" x2="7.76" y2="7.76" />
        <line x1="16.24" y1="16.24" x2="19.07" y2="19.07" />
        <line x1="2" y1="12" x2="6" y2="12" />
        <line x1="18" y1="12" x2="22" y2="12" />
        <line x1="4.93" y1="19.07" x2="7.76" y2="16.24" />
        <line x1="16.24" y1="7.76" x2="19.07" y2="4.93" />
    </svg>
);

const SHIPPING_OPTIONS_DATA = [
  { id: 'balik_box', name: 'Bal칤kovna do Bal칤kovny', price: 50, icon: <React.Fragment><IconPackage /><IconBox /></React.Fragment>, type: 'pickup' },
  { id: 'zasil_box', name: 'Z치silkovna do Z-Boxu', price: 89, icon: <React.Fragment><IconPost /><IconBox /></React.Fragment>, type: 'pickup' },
];


// --- APP CONTEXT (STATE MANAGEMENT) ---

const AppContext = createContext(undefined);

const AppProvider = ({ children }) => {
  const [currentPage, setCurrentPage] = useState('home');
  const [currentProduct, setCurrentProduct] = useState('fox');
  const [cart, setCart] = useState([]);
  const [shippingOptionId, setShippingOptionId] = useState('zasil_box');
  const [selectedPickupPoint, setSelectedPickupPoint] = useState(null);
  const [shippingAddress, setShippingAddressState] = useState({
    city: '',
    zip: '',
    street: '',
    number: '',
  });
  const [toastMessage, setToastMessage] = useState(null);
  const [orderConfirmation, setOrderConfirmation] = useState(null);
  const [isSubmitting, setIsSubmitting] = useState(false);


  const showToast = (message) => {
    setToastMessage(message);
    setTimeout(() => {
      setToastMessage(null);
    }, 3000);
  };

  const clearToast = () => {
    setToastMessage(null);
  };

  const navigateTo = (page, productId = 'fox') => {
    setCurrentPage(page);
    if (page === 'product') {
      setCurrentProduct(productId);
    }
    if (page !== 'confirmation') {
      setOrderConfirmation(null);
    }
    window.scrollTo(0, 0);
  };

  // *** UPRAVENO: addToCart nyn칤 p콏id치v치 'type: product' ***
  const addToCart = (productId, quantity) => {
    setCart((prevCart) => {
      // Hled치me pouze existuj칤c칤 produkt stejn칠ho typu
      const existingItem = prevCart.find((item) => item.id === productId && item.type === 'product');
      if (existingItem) {
        return prevCart.map((item) =>
          (item.id === productId && item.type === 'product')
            ? { ...item, quantity: item.quantity + quantity }
            : item
        );
      }
      // P콏id치v치me nov칳 produkt
      return [...prevCart, { id: productId, quantity: quantity, type: 'product' }];
    });
    showToast(`"${PRODUCT_DATA[productId].name}" p콏id치n do ko코칤ku!`);
  };
  
  // *** NOVINKA: Funkce pro p콏id치n칤 zak치zkov칠ho tisku ***
  const addCustomItemToCart = (item) => {
    setCart((prevCart) => {
      // Zak치zkov칳 tisk je v쬯y unik치tn칤, tak쬰 ho jen p콏id치me
      return [...prevCart, item];
    });
    showToast(`"${item.customDetails.name}" p콏id치n do ko코칤ku!`);
  };

  // *** UPRAVENO: Nyn칤 pracuje s 'itemId' ***
  const updateCartItemQuantity = (itemId, newQuantity) => {
    if (newQuantity <= 0) {
      removeFromCart(itemId);
    } else {
      setCart((prevCart) =>
        prevCart.map((item) =>
          item.id === itemId ? { ...item, quantity: newQuantity } : item
        )
      );
    }
  };

  // *** UPRAVENO: Nyn칤 pracuje s 'itemId' a zobrazuje spr치vn칠 jm칠no ***
  const removeFromCart = (itemId) => {
    // Najdeme item, abychom mohli zobrazit spr치vn칠 jm칠no v toastu
    const itemToRemove = cart.find((item) => item.id === itemId);
    if (!itemToRemove) return;

    setCart((prevCart) => prevCart.filter((item) => item.id !== itemId));
    
    const name = itemToRemove.type === 'product'
      ? PRODUCT_DATA[itemToRemove.id].name
      : itemToRemove.customDetails.name;
      
    showToast(`"${name}" odebr치n z ko코칤ku.`);
  };

  const clearCart = () => {
    setCart([]);
  };

  const selectShippingOption = (optionId) => {
    setShippingOptionId(optionId);
    setSelectedPickupPoint(null);
  };

  const selectPickupPoint = (point) => {
    setSelectedPickupPoint(point);
  };

  const setShippingAddress = (address) => {
    setShippingAddressState((prev) => ({ ...prev, ...address }));
  };

  // *** UPRAVENO: `submitOrder` nyn칤 rozpozn치v치 'product' a 'custom' typy ***
  const submitOrder = async (contactDetails, orderDetails, shippingOption, pickupPoint) => {
    setIsSubmitting(true);
    
    const mockOrderId = `2025-${Math.floor(Math.random() * 1000) + 1}`;

    // *** ZDE JE KL칈캛OV츼 칔PRAVA ***
    // Sestav칤me detaily polo쬰k tak, aby jim serverless funkce rozum캩la
    const itemsWithDetails = orderDetails.items.map(item => {
        if (item.type === 'product') {
            // Standardn칤 produkt
            return {
                id: item.id,
                quantity: item.quantity,
                productName: PRODUCT_DATA[item.id].name,
                price: PRODUCT_DATA[item.id].price
            };
        }
        // Zak치zkov칳 produkt
        // V코echny pot콏ebn칠 informace vlo쮂셠e do 'productName',
        // proto쬰 v칤me, 쬰 `api/send-order-email.js` toto pole vypisuje.
        return {
             id: item.id,
             quantity: item.quantity,
             productName: `${item.customDetails.name} (Soubor: ${item.customDetails.fileName}, ${item.customDetails.volumeCm3.toFixed(2)} cm췁, ${item.customDetails.material})`,
             price: item.customDetails.price,
        };
    });

    const finalOrderDetails = {
        ...orderDetails,
        orderId: mockOrderId,
        items: itemsWithDetails, // Pou쬴jeme upraven칠 polo쬶y
    };

    const payload = {
      contact: contactDetails,
      order: finalOrderDetails,
      shippingOption: shippingOption,
      pickupPoint: pickupPoint,
    };

    try {
      const response = await fetch('/api/send-order-email', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload),
      });

      if (!response.ok) {
        throw new Error('Chyba p콏i odes칤l치n칤 objedn치vky.');
      }

      const confirmation = {
        orderId: mockOrderId,
        contact: contactDetails,
        order: orderDetails, // Zde pou쬴jeme P콡VODN칈 orderDetails (s 'cart' polem) pro zobrazen칤 na frontend
        shippingOption: shippingOption,
        pickupPoint: pickupPoint,
      };

      setOrderConfirmation(confirmation);
      clearCart();
      navigateTo('confirmation');

    } catch (error) {
      console.error("Failed to submit order:", error);
      showToast('Nastala chyba p콏i odes칤l치n칤 objedn치vky. Zkuste to pros칤m znovu.');
    } finally {
        setIsSubmitting(false);
    }
  };

  // --- Odvozen칳 stav (Memoized) ---

  const totalCartItems = useMemo(() => {
    return cart.reduce((total, item) => total + item.quantity, 0);
  }, [cart]);

  // *** UPRAVENO: `cartSubtotal` nyn칤 rozpozn치v치 'product' a 'custom' typy ***
  const cartSubtotal = useMemo(() => {
    return cart.reduce((total, item) => {
      if (item.type === 'product') {
        return total + PRODUCT_DATA[item.id].price * item.quantity;
      }
      if (item.type === 'custom') {
        // U zak치zkov칠ho tisku je cena ulo쬰na p콏칤mo v objektu
        return total + item.customDetails.price * item.quantity;
      }
      return total; // Pro jistotu
    }, 0);
  }, [cart]);

  const shippingCost = useMemo(() => {
    if (cart.length === 0) return 0;
    if (cartSubtotal >= FREE_SHIPPING_THRESHOLD) return 0;
    const selectedOption = SHIPPING_OPTIONS_DATA.find(opt => opt.id === shippingOptionId);
    return selectedOption ? selectedOption.price : DEFAULT_SHIPPING_COST;
  }, [cart, cartSubtotal, shippingOptionId]);

  const totalPrice = useMemo(() => {
    return cartSubtotal + shippingCost;
  }, [cartSubtotal, shippingCost]);

  const value = {
    currentPage,
    currentProduct,
    cart,
    shippingOptionId,
    selectedPickupPoint,
    shippingAddress,
    toastMessage,
    orderConfirmation,
    isSubmitting,
    navigateTo,
    addToCart,
    addCustomItemToCart, // *** NOVINKA: P콏id치no do kontextu ***
    updateCartItemQuantity,
    removeFromCart,
    clearCart,
    selectShippingOption,
    selectPickupPoint,
    setShippingAddress,
    showToast,
    clearToast,
    submitOrder,
    totalCartItems,
    cartSubtotal,
    shippingCost,
    totalPrice,
  };

  return <AppContext.Provider value={value}>{children}</AppContext.Provider>;
};

const useAppContext = () => {
  const context = useContext(AppContext);
  if (context === undefined) {
    throw new Error('useAppContext must be used within an AppProvider');
  }
  return context;
};


// --- UI KOMPONENTY (SHADCN/UI N츼HRADA) ---
// (V코echny st치vaj칤c칤 komponenty - Button, Input, atd. - z콢st치vaj칤 beze zm캩ny)

// Button
const Button = forwardRef(
  ({ className = '', variant = 'default', size = 'default', ...props }, ref) => {
    const variants = {
      default: 'bg-black text-white hover:bg-gray-800',
      destructive: 'bg-red-600 text-white hover:bg-red-700',
      outline: 'border border-black bg-transparent hover:bg-gray-100',
      secondary: 'bg-gray-100 text-black hover:bg-gray-200',
      ghost: 'hover:bg-gray-100',
      link: 'text-black underline-offset-4 hover:underline',
    };
    const sizes = {
      default: 'h-10 px-4 py-2',
      sm: 'h-9 rounded-md px-3',
      lg: 'h-11 rounded-md px-8',
      icon: 'h-10 w-10',
    };
    const baseStyles = 'inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50';
    
    return (
      <button
        className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className}`}
        ref={ref}
        {...props}
      />
    );
  }
);

// Input
const Input = forwardRef(
  ({ className = '', ...props }, ref) => {
    return (
      <input
        className={`flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${className}`}
        ref={ref}
        {...props}
      />
    );
  }
);

// Textarea
const Textarea = forwardRef(
  ({ className = '', ...props }, ref) => {
    return (
      <textarea
        className={`flex min-h-[80px] w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${className}`}
        ref={ref}
        {...props}
      />
    );
  }
);

// Label
const Label = forwardRef(
  ({ className = '', ...props }, ref) => {
    return (
      <label
        className={`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${className}`}
        ref={ref}
        {...props}
      />
    );
  }
);

// RadioGroup (Mock)
const RadioGroupContext = createContext(null);

const RadioGroup = ({
  value,
  onValueChange,
  name,
  children,
  className = "" // P콏id치na className
}) => {
  return (
    <RadioGroupContext.Provider value={{ name: name || 'radio-group', value, onChange: onValueChange }}>
      <div role="radiogroup" className={`space-y-2 ${className}`}> {/* Pou쬴ta className */}
        {children}
      </div>
    </RadioGroupContext.Provider>
  );
};

const RadioGroupItem = ({
  value,
  id,
  children,
  className = '',
}) => {
  const context = useContext(RadioGroupContext);
  if (!context) {
    throw new Error('RadioGroupItem must be used within a RadioGroup');
  }
  
  const isSelected = context.value === value;
  
  return (
    <div
      className={`flex items-center gap-4 rounded-lg border p-4 transition-all cursor-pointer ${
        isSelected ? 'border-black bg-gray-50 ring-2 ring-black' : 'border-gray-300 bg-white hover:bg-gray-50'
      } ${className}`}
      onClick={() => context.onChange(value)}
    >
      <button
        id={id}
        type="button"
        role="radio"
        aria-checked={isSelected}
        className="h-5 w-5 flex-shrink-0 rounded-full border-2 border-black flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2"
      >
        {isSelected && <div className="h-2.5 w-2.5 rounded-full bg-black" />}
      </button>
      <Label htmlFor={id} className="cursor-pointer flex-1">
        {children}
      </Label>
    </div>
  );
};

// Tabs (Mock)
const TabsContext = createContext(null);

const Tabs = ({
  defaultValue,
  children,
}) => {
  const [activeTab, setActiveTab] = useState(defaultValue);
  return (
    <TabsContext.Provider value={{ activeTab, setActiveTab }}>
      <div>{children}</div>
    </TabsContext.Provider>
  );
};

const TabsList = ({ children, className = "" }) => (
  <div className={`flex items-center border-b border-gray-300 ${className}`}>
    {children}
  </div>
);

const TabsTrigger = ({
  value,
  children,
  className = ""
}) => {
  const context = useContext(TabsContext);
  if (!context) throw new Error('TabsTrigger must be used within a Tabs');
  
  const isActive = context.activeTab === value;
  
  return (
    <button
      type="button"
      role="tab"
      aria-selected={isActive}
      onClick={() => context.setActiveTab(value)}
      className={`-mb-px border-b-2 px-4 py-3 text-sm font-medium transition-colors ${
        isActive
          ? 'border-black text-black'
          : 'border-transparent text-gray-600 hover:border-gray-400 hover:text-black'
      } ${className}`}
    >
      {children}
    </button>
  );
};

const TabsContent = ({
  value,
  children,
  className = ""
}) => {
  const context = useContext(TabsContext);
  if (!context) throw new Error('TabsContent must be used within a Tabs');
  
  return context.activeTab === value ? (
    <div role="tabpanel" className={`py-6 ${className}`}>
      {children}
    </div>
  ) : null;
};

// Progress
const Progress = ({ value = 0, className = "" }) => {
  const clampedValue = Math.min(100, Math.max(0, value));
  return (
    <div
      className={`relative h-2 w-full overflow-hidden rounded-full bg-gray-200 ${className}`}
    >
      <div
        className="h-full w-full flex-1 bg-green-600 transition-all"
        style={{ transform: `translateX(-${100 - clampedValue}%)` }}
      />
    </div>
  );
};

// Badge
const Badge = ({
  variant = 'default',
  className = '',
  ...props
}) => {
  const variants = {
    default: 'border-transparent bg-black text-white',
    success: 'border-transparent bg-green-600 text-white',
    destructive: 'border-transparent bg-red-600 text-white',
  };
  return (
    <div
      className={`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors ${variants[variant]} ${className}`}
      {...props}
    />
  );
};

// Card (Mock)
const Card = ({ className = '', ...props }) => (
  <div className={`rounded-lg border bg-white text-black shadow-sm ${className}`} {...props} />
);

const CardHeader = ({ className = '', ...props }) => (
  <div className={`flex flex-col space-y-1.5 p-6 ${className}`} {...props} />
);

const CardTitle = ({ className = '', ...props }) => (
  <h3 className={`text-lg font-semibold leading-none tracking-tight ${className}`} {...props} />
);

const CardDescription = ({ className = '', ...props }) => (
  <p className={`text-sm text-gray-600 ${className}`} {...props} />
);

const CardContent = ({ className = '', ...props }) => (
  <div className={`p-6 pt-0 ${className}`} {...props} />
);

const CardFooter = ({ className = '', ...props }) => (
  <div className={`flex items-center p-6 pt-0 ${className}`} {...props} />
);

// Toast (Sonner Mock)
const Toast = () => {
  const { toastMessage, clearToast } = useAppContext();
  
  if (!toastMessage) return null;
  
  return (
    <div className="fixed bottom-5 right-5 z-50">
      <div className="flex items-center justify-between gap-4 rounded-lg bg-black p-4 text-white shadow-lg animate-pulse">
        <span>{toastMessage}</span>
        <button onClick={clearToast} className="rounded-full p-1 hover:bg-gray-700">
          <IconX size={16} />
        </button>
      </div>
    </div>
  );
};

// Fallback pro obr치zky
const ImageWithFallback = ({ src, alt, className = "", ...props }) => {
  return (
    <img
      src={src}
      alt={alt}
      className={className}
      onError={(e) => {
        (e.target).src = `https://placehold.co/600x600/e0e0e0/9ca3af?text=Obr치zek+chyb칤`;
      }}
      {...props}
    />
  );
};

// Komponenta pro hv캩zdi캜ky
const StarRating = ({ rating, size = 20 }) => {
  return (
    <div className="flex items-center">
      {[...Array(5)].map((_, i) => (
        <IconStar
          key={i}
          size={size}
          className={i < Math.round(rating) ? 'text-black' : 'text-gray-300'}
        />
      ))}
    </div>
  );
};


// --- KOMPONENTY STR츼NEK ---

// Header
// *** UPRAVENO: P콏id치n link na 'Zak치zkov칳 tisk' ***
const Header = () => {
  const { navigateTo, totalCartItems } = useAppContext();
  
  return (
    <header className="sticky top-0 z-40 w-full bg-white shadow-sm">
      {/* Top Banner */}
      <div className="bg-black py-2.5 text-white">
        <div className="container mx-auto flex max-w-7xl items-center justify-center gap-2 px-4 text-sm font-medium">
          <IconTruck size={16} />
          <span>Doprava ZDARMA nad 1000 K캜!</span>
        </div>
      </div>
      
      {/* Hlavn칤 navigace */}
      <nav className="container mx-auto flex max-w-7xl items-center justify-between p-4">
        {/* Lev치 strana - Logo */}
        <div
          className="flex cursor-pointer items-center gap-2"
          onClick={() => navigateTo('home')}
        >
          <span className="flex h-10 w-10 items-center justify-center rounded-full bg-black text-2xl">
            游붉
          </span>
          <span className="text-lg font-bold tracking-tight">3D P콎칈V캨SKY</span>
        </div>
        
        {/* St콏ed - Menu (Desktop) */}
        <div className="hidden items-center gap-6 md:flex">
          <Button variant="link" onClick={() => navigateTo('home')}>Dom콢</Button>
          <Button variant="link" onClick={() => navigateTo('product', 'fox')}>Kolekce</Button>
          {/* NOV칗 ODKAZ */}
          <Button variant="link" onClick={() => navigateTo('customPrint')}>Zak치zkov칳 tisk</Button>
          <Button variant="link" onClick={() => navigateTo('printing')}>3D Tisk & Kvalita</Button>
          <Button variant="link" onClick={() => navigateTo('contact')}>Kontakt</Button>
        </div>
        
        {/* Prav치 strana - Ikony */}
        <div className="flex items-center gap-4">
          <Button variant="ghost" size="icon">
            <IconSearch size={20} />
          </Button>
          <Button variant="ghost" size="icon">
            <IconUser size={20} />
          </Button>
          <Button
            variant="ghost"
            size="icon"
            className="relative"
            onClick={() => navigateTo('cart')}
          >
            <IconShoppingBag size={20} />
            {totalCartItems > 0 && (
              <span className="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-black text-xs font-bold text-white">
                {totalCartItems}
              </span>
            )}
          </Button>
        </div>
      </nav>
    </header>
  );
};

// Footer
// *** UPRAVENO: P콏id치n link na 'Zak치zkov칳 tisk' ***
const Footer = () => {
  const { navigateTo } = useAppContext();
  
  return (
    <footer className="bg-black text-white">
      <div className="container mx-auto grid max-w-7xl grid-cols-1 gap-12 p-10 md:grid-cols-4">
        {/* Sloupec 1 - O n치s */}
        <div className="space-y-4">
          <div className="flex items-center gap-2">
            <span className="flex h-10 w-10 items-center justify-center rounded-full bg-white text-2xl">
              游붉
            </span>
            <span className="text-lg font-bold">3D P콎칈V캨SKY</span>
          </div>
          <p className="text-sm text-gray-300">
            Origin치ln칤 3D ti코t캩n칠 p콏칤v캩sky a zak치zkov칳 3D tisk. Precizn칤 design, 캜esk치 v칳roba.
          </p>
        </div>
        
        {/* Sloupec 2 - Rychl칠 odkazy */}
        <div className="space-y-2">
          <h4 className="font-semibold">Rychl칠 odkazy</h4>
          <ul className="space-y-1 text-sm text-gray-300">
            <li><Button variant="link" className="p-0 text-gray-300 hover:text-white" onClick={() => navigateTo('home')}>Dom콢</Button></li>
            <li><Button variant="link" className="p-0 text-gray-300 hover:text-white" onClick={() => navigateTo('product', 'fox')}>Kolekce</Button></li>
            {/* NOV칗 ODKAZ */}
            <li><Button variant="link" className="p-0 text-gray-300 hover:text-white" onClick={() => navigateTo('customPrint')}>Zak치zkov칳 tisk</Button></li>
            <li><Button variant="link" className="p-0 text-gray-300 hover:text-white" onClick={() => navigateTo('printing')}>3D Tisk & Kvalita</Button></li>
            <li><Button variant="link" className="p-0 text-gray-300 hover:text-white" onClick={() => navigateTo('contact')}>Kontakt</Button></li>
          </ul>
        </div>

        {/* Sloupec 3 - Z치kaznick칳 servis */}
        <div className="space-y-2">
          <h4 className="font-semibold">Z치kaznick칳 servis</h4>
          <ul className="space-y-1 text-sm text-gray-300">
            <li><button className="p-0 text-gray-300 hover:text-white hover:underline">캛asto kladen칠 dotazy</button></li>
            <li><button className="p-0 text-gray-300 hover:text-white hover:underline">Doprava a platba</button></li>
            <li><button className="p-0 text-gray-300 hover:text-white hover:underline">Reklamace a vr치cen칤 zbo쮂</button></li>
            <li><button className="p-0 text-gray-300 hover:text-white hover:underline">Obchodn칤 podm칤nky</button></li>
          </ul>
        </div>
        
        {/* Sloupec 4 - Kontakt */}
        <div className="space-y-2">
          <h4 className="font-semibold">Kontakt</h4>
          <ul className="space-y-2 text-sm text-gray-300">
            <li><a href="mailto:sf.simonflorian@gmail.com" className="hover:text-white hover:underline">sf.simonflorian@gmail.com</a></li>
          </ul>
          <div className="flex gap-2 pt-2">
            <a href="#" className="rounded-full p-2 hover:bg-gray-700"><IconInstagram size={20} /></a>
            <a href="#" className="rounded-full p-2 hover:bg-gray-700"><IconFacebook size={20} /></a>
          </div>
        </div>
      </div>
      
      {/* Copyright */}
      <div className="container mx-auto max-w-7xl border-t border-gray-700 p-6 text-center">
        <p className="text-sm text-gray-400">
          춸 2025 3D P콏칤v캩sky. V코echna pr치va vyhrazena.
        </p>
      </div>
    </footer>
  );
};

// Karta produktu
const ProductCard = ({ product }) => {
  const { navigateTo, addToCart } = useAppContext();
  
  return (
    <Card className="group cursor-pointer overflow-hidden" onClick={() => navigateTo('product', product.id)}>
      <CardContent className="p-0">
        <div className="aspect-square overflow-hidden">
          <ImageWithFallback
            src={product.images[0]}
            alt={product.name}
            className="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
          />
        </div>
        <div className="p-4 space-y-2">
          <div>
            <h3 className="text-lg font-medium">{product.name}</h3>
            <p className="text-sm text-gray-600">{product.subtitle}</p>
          </div>
          <p className="text-lg font-semibold">{product.price} K캜</p>
          <Button
            className="w-full"
            onClick={(e) => {
              e.stopPropagation();
              addToCart(product.id, 1);
            }}
          >
            <IconShoppingBag size={16} className="mr-2" />
            P콏idat do ko코칤ku
          </Button>
        </div>
      </CardContent>
    </Card>
  );
};

// Domovsk치 str치nka (beze zm캩ny)
const HomePage = () => {
  const { navigateTo } = useAppContext();
  
  return (
    <div className="space-y-16 md:space-y-24">
      {/* Hero sekce */}
      <section className="bg-black text-white">
        <div className="container mx-auto grid max-w-7xl grid-cols-1 items-center gap-8 px-4 py-16 md:grid-cols-2 md:py-24">
          <div className="space-y-6 text-center md:text-left">
            <h1 className="text-4xl font-bold tracking-tighter md:text-5xl lg:text-6xl">
              Precizn칤 design. Cena, co pot캩코칤.
            </h1>
            <p className="text-lg text-gray-300 md:text-xl">
              Objevte 3D ti코t캩n칠 p콏칤v캩sky s propracovan칳mi detaily. Jednotn치 cena 59 K캜.
            </p>
            <Button
              size="lg"
              className="bg-white text-black hover:bg-gray-200"
              onClick={() => navigateTo('product', 'dog')}
            >
              Koupit za 59 K캜
            </Button>
          </div>
          <div className="flex justify-center">
            <ImageWithFallback
              src={IMAGES.dog_vanoce}
              alt="P콏칤v캩sek Pes V치noce"
              className="w-full max-w-md rounded-lg object-cover"
            />
          </div>
        </div>
      </section>
      
      {/* Produktov치 kolekce */}
      <section className="container mx-auto max-w-7xl px-4">
        <div className="mx-auto max-w-3xl text-center">
          <h2 className="text-3xl font-bold tracking-tighter md:text-4xl">Na코e st치l치 nab칤dka a novinky</h2>
          <p className="mt-4 text-lg text-gray-600">
            Ka쬯칳 p콏칤v캩sek je vyroben s maxim치ln칤 p칠캜칤 o detail pomoc칤 pokro캜il칠 technologie 3D tisku.
          </p>
        </div>
        <div className="mt-12 grid grid-cols-1 gap-6 md:grid-cols-2 lg:gap-8">
          <ProductCard product={PRODUCT_DATA.fox} />
          <ProductCard product={PRODUCT_DATA.dog} />
        </div>
      </section>
      
      {/* 3D Technology sekce */}
      <section className="bg-gray-50/70 py-16 md:py-24">
        <div className="container mx-auto max-w-7xl px-4">
          <div className="mx-auto max-w-3xl text-center">
            <h2 className="text-3xl font-bold tracking-tighter md:text-4xl">Kvalita z PLA filamentu</h2>
            <p className="mt-4 text-lg text-gray-600">
              V코echny na코e produkty tiskneme z pr칠miov칠ho PLA, co je ekologick칳 a vysoce odoln칳 bioplast.
            </p>
          </div>
          <div className="mt-12 grid grid-cols-1 gap-8 md:grid-cols-3">
            <div className="rounded-lg bg-white p-6 text-center shadow-sm">
              <div className="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-black text-white">
                <IconLeaf size={28} />
              </div>
              <h3 className="mt-4 text-xl font-semibold">Materi치l PLA</h3>
              <p className="mt-2 text-gray-600">Ekologick칳 a pevn칳 bioplast z kuku콏i캜n칠ho 코krobu.</p>
            </div>
            <div className="rounded-lg bg-white p-6 text-center shadow-sm">
              <div className="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-black text-white">
                <IconAward size={28} />
              </div>
              <h3 className="mt-4 text-xl font-semibold">Odoln칳 a Lehk칳</h3>
              <p className="mt-2 text-gray-600">Perfektn칤 balanc pro ka쬯odenn칤 no코en칤 a dlouhou 쬴votnost.</p>
            </div>
            <div className="rounded-lg bg-white p-6 text-center shadow-sm">
              <div className="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-black text-white">
                <IconPrinter size={28} />
              </div>
              <h3 className="mt-4 text-xl font-semibold">캛esk칳 Design</h3>
              <p className="mt-2 text-gray-600">Vyrobeno s preciznost칤 a p칠캜칤 v 캛esk칠 republice.</p>
            </div>
          </div>
          <div className="mt-12 text-center">
            <Button variant="outline" size="lg" onClick={() => navigateTo('printing')}>
              V칤ce o V칳rob캩
            </Button>
          </div>
        </div>
      </section>
      
      {/* Social Proof sekce */}
      <section className="container mx-auto max-w-7xl px-4">
        <div className="mx-auto max-w-3xl text-center">
          <h2 className="text-3xl font-bold tracking-tighter md:text-4xl">Doporu캜uj칤 Z치kazn칤ci</h2>
          <div className="mt-4 flex items-center justify-center gap-2">
            <StarRating rating={4.9} />
            <span className="text-lg font-medium text-gray-800">4.9 / 5</span>
          </div>
          <blockquote className="mt-6 text-lg italic text-gray-700">
            "Za tuhle cenu naprost치 bomba! Kvalita 3D tisku je skv캩l치, materi치l je p콏칤jemn칳 a odoln칳. Koupila jsem li코ku i psa a oba vypadaj칤 칰쬬sn캩 na batohu."
            <footer className="mt-4 block text-base not-italic text-gray-600"> Tereza N., Ov캩콏en칳 z치kazn칤k</footer>
          </blockquote>
          <p className="mt-8 text-lg font-medium text-gray-800">
            Sd칤lejte s n치mi! <span className="text-black">#3DPrivesky</span>
          </p>
        </div>
        <div className="mt-12 grid grid-cols-2 gap-4 md:grid-cols-3">
          <ImageWithFallback src={IMAGES.fox_batoh} alt="Li코ka na batohu" className="aspect-square w-full rounded-lg object-cover shadow-sm transition-transform hover:scale-105" />
          <ImageWithFallback src={IMAGES.dog_dvere} alt="Pes u dve콏칤" className="aspect-square w-full rounded-lg object-cover shadow-sm transition-transform hover:scale-105" />
          <ImageWithFallback src={IMAGES.fox_klice} alt="Li코ka na kl칤캜칤ch" className="aspect-square w-full rounded-lg object-cover shadow-sm transition-transform hover:scale-105" />
          <ImageWithFallback src={IMAGES.dog_batoh} alt="Pes na batohu" className="aspect-square w-full rounded-lg object-cover shadow-sm transition-transform hover:scale-105" />
          <ImageWithFallback src={IMAGES.fox_les} alt="Li코ka v lese" className="aspect-square w-full rounded-lg object-cover shadow-sm transition-transform hover:scale-105" />
          <ImageWithFallback src={IMAGES.dog_vanoce} alt="Pes v치noce" className="aspect-square w-full rounded-lg object-cover shadow-sm transition-transform hover:scale-105" />
        </div>
      </section>
      
      {/* Newsletter sekce */}
      <section className="bg-gray-50/70 py-16 md:py-24">
        <div className="container mx-auto max-w-3xl px-4 text-center">
          <h2 className="text-3xl font-bold tracking-tighter md:text-4xl">Sledujte Novinky a Akce</h2>
          <p className="mt-4 text-lg text-gray-600">
            P콏ihlaste se k odb캩ru a bu캞te prvn칤, kdo se dozv칤 o nov칳ch produktech a speci치ln칤ch nab칤dk치ch.
          </p>
          <form className="mt-8 flex flex-col gap-4 sm:flex-row">
            <Input type="email" placeholder="V치코 e-mail" className="flex-1" />
            <Button type="submit" size="lg" className="w-full sm:w-auto">Odeb칤rat</Button>
          </form>
        </div>
      </section>
    </div>
  );
};

// Detail produktu (beze zm캩ny)
const ProductDetailPage = () => {
  const { currentProduct, navigateTo, addToCart } = useAppContext();
  const product = PRODUCT_DATA[currentProduct];
  
  const [mainImage, setMainImage] = useState(product.images[0]);
  const [quantity, setQuantity] = useState(1);
  
  const averageRating = useMemo(() => {
    return product.reviews.reduce((acc, r) => acc + r.rating, 0) / product.reviews.length;
  }, [product.reviews]);
  
  const handleQuantityChange = (amount) => {
    setQuantity(prev => Math.max(1, prev + amount));
  };

  const handleAddToCart = () => {
    addToCart(product.id, quantity);
    setQuantity(1);
  };
  
  return (
    <div className="container mx-auto max-w-7xl px-4 py-8 md:py-12">
      {/* Breadcrumbs */}
      <nav className="mb-6 flex items-center gap-2 text-sm text-gray-600">
        <Button variant="link" className="p-0 text-gray-600" onClick={() => navigateTo('home')}>Dom콢</Button>
        <IconChevronRight size={16} />
        <Button variant="link" className="p-0 text-gray-600" onClick={() => navigateTo('product', 'fox')}>Kolekce</Button>
        <IconChevronRight size={16} />
        <span className="font-medium text-black">{product.name}</span>
      </nav>
      
      <div className="grid grid-cols-1 gap-12 md:grid-cols-2">
        {/* Lev치 strana - Obr치zky */}
        <div className="space-y-4">
          <div className="aspect-square w-full overflow-hidden rounded-lg border">
            <ImageWithFallback src={mainImage} alt={product.name} className="h-full w-full object-cover" />
          </div>
          <div className="grid grid-cols-4 gap-4">
            {product.images.map((img, idx) => (
              <button
                key={idx}
                className={`aspect-square w-full overflow-hidden rounded-md border-2 transition-colors ${
                  mainImage === img ? 'border-black' : 'border-gray-200 hover:border-gray-400'
                }`}
                onClick={() => setMainImage(img)}
              >
                <ImageWithFallback src={img} alt={`N치hled ${idx + 1}`} className="h-full w-full object-cover" />
              </button>
            ))}
          </div>
        </div>
        
        {/* Prav치 strana - Info */}
        <div className="space-y-6">
          <h1 className="text-3xl font-bold md:text-4xl">{product.name}</h1>
          <p className="text-3xl font-semibold">{product.price} K캜</p>
          
          <div className="flex items-center gap-2">
            <StarRating rating={averageRating} />
            <span className="text-sm text-gray-600">({averageRating.toFixed(1)}/5 췅 {product.reviews.length} hodnocen칤)</span>
          </div>
          
          <p className="text-base text-gray-700">{product.description}</p>
          
          <div className="space-y-4 rounded-lg bg-gray-50/70 p-4">
            <ul className="space-y-2 text-sm">
              <li><strong>Rozm캩ry:</strong> {product.details.dimensions}</li>
              <li><strong>Materi치l:</strong> {product.details.material}</li>
              <li><strong>Barvy:</strong> {product.details.colors}</li>
            </ul>
            <Badge variant="success">Skladem</Badge>
          </div>
          
          {/* Po캜et kus콢 */}
          <div className="space-y-2">
            <Label htmlFor="quantity">Po캜et kus콢</Label>
            <div className="flex w-fit items-center rounded-md border">
              <Button variant="ghost" size="icon" onClick={() => handleQuantityChange(-1)} disabled={quantity <= 1} className="h-11 rounded-r-none border-r">
                <IconMinus />
              </Button>
              <span id="quantity" className="w-12 text-center text-lg font-medium">{quantity}</span>
              <Button variant="ghost" size="icon" onClick={() => handleQuantityChange(1)} className="h-11 rounded-l-none border-l">
                <IconPlus />
              </Button>
            </div>
          </div>
          
          <Button size="lg" className="w-full" onClick={handleAddToCart}>
            P콏idat do ko코칤ku za {product.price * quantity} K캜
          </Button>
          
          {/* Z치ruky */}
          <div className="space-y-3 border-t pt-6 text-sm text-gray-700">
            <div className="flex items-center gap-3">
              <IconTruck size={20} className="text-green-600" />
              <span>Doprava ZDARMA nad 1000 K캜</span>
            </div>
            <div className="flex items-center gap-3">
              <IconAward size={20} className="text-black" />
              <span>Garance 30 dn칤 na vr치cen칤</span>
            </div>
            <div className="flex items-center gap-3">
              <IconPrinter size={20} className="text-black" />
              <span>캛esk치 v칳roba</span>
            </div>
          </div>
        </div>
      </div>
      
      {/* Tabs sekce */}
      <div className="mt-16 md:mt-24">
        <Tabs defaultValue="description">
          <TabsList>
            <TabsTrigger value="description">Popis</TabsTrigger>
            <TabsTrigger value="reviews">Hodnocen칤 ({product.reviews.length})</TabsTrigger>
          </TabsList>
          
          <TabsContent value="description" className="prose max-w-none text-gray-700">
            <h3>O Produktu</h3>
            <p>{product.description} Tento p콏칤v캩sek je navr쬰n tak, aby byl lehk칳 na no코en칤, ale z치rove켿 dostate캜n캩 pevn칳, aby vydr쬰l ka쬯odenn칤 pou쮂셨치n칤 na kl칤캜칤ch, batohu nebo ta코ce. D칤ky precizn칤mu 3D tisku jsou viditeln칠 i ty nejmen코칤 detaily.</p>
            <h3>Materi치l a Kvalita</h3>
            <p>Pou쮂셨치me v칳hradn캩 PLA (Polylactic Acid) filament, co je bioplast vyroben칳 z obnoviteln칳ch zdroj콢, jako je kuku콏i캜n칳 코krob. Je ekologicky 코etrn칳 a biologicky odbourateln칳. PLA je zn치m칠 svou pevnost칤, n칤zkou hmotnost칤 a schopnost칤 zachytit 쬴v칠 barvy.</p>
            <h3>P칠캜e o Produkt</h3>
            <p>P콏칤v캩sek je odoln칳, ale pro zachov치n칤 jeho kr치sy ho nevystavujte extr칠mn캩 vysok칳m teplot치m (nap콏. v aut캩 na p콏칤m칠m slunci v l칠t캩) ani dlouhodob칠mu p콢soben칤 vody. 캛ist캩te jej snadno such칳m nebo m칤rn캩 navlh캜en칳m had콏칤kem.</p>
          </TabsContent>
          
          <TabsContent value="reviews">
            <h3 className="text-xl font-semibold">Hodnocen칤 z치kazn칤k콢</h3>
            <div className="mt-4 space-y-6">
              {product.reviews.map(review => (
                <div key={review.id} className="border-b pb-6">
                  <div className="flex items-center justify-between">
                    <StarRating rating={review.rating} />
                    <span className="text-sm text-gray-500">{review.date}</span>
                  </div>
                  <h4 className="mt-2 text-base font-medium">{review.author}</h4>
                  <p className="mt-1 text-gray-700">{review.text}</p>
                </div>
              ))}
            </div>
          </TabsContent>
        </Tabs>
      </div>
      
      {/* Souvisej칤c칤 produkty */}
      <div className="mt-16 md:mt-24">
        <h2 className="text-3xl font-bold tracking-tighter">Mohlo by se v치m l칤bit</h2>
        <div className="mt-8 grid grid-cols-1 gap-6 md:grid-cols-2">
          <ProductCard product={product.id === 'fox' ? PRODUCT_DATA.dog : PRODUCT_DATA.fox} />
        </div>
      </div>
    </div>
  );
};

// *** UPRAVENO: Str치nka ko코칤ku nyn칤 zobrazuje i zak치zkov칠 polo쬶y ***
const CartPage = () => {
  const { cart, navigateTo, updateCartItemQuantity, removeFromCart, totalCartItems, cartSubtotal, shippingCost, totalPrice } = useAppContext();
  
  const remainingForFreeShipping = FREE_SHIPPING_THRESHOLD - cartSubtotal;
  const freeShippingProgress = Math.min(100, (cartSubtotal / FREE_SHIPPING_THRESHOLD) * 100);

  return (
    <React.Fragment>
      <section className="bg-black text-white">
        <div className="container mx-auto max-w-7xl px-4 py-12 text-center">
          <h1 className="text-4xl font-bold tracking-tighter">N치kupn칤 Ko코칤k</h1>
        </div>
      </section>
      
      <div className="container mx-auto max-w-7xl px-4 py-12">
        {cart.length === 0 ? (
          // Pr치zdn칳 ko코칤k
          <div className="flex flex-col items-center justify-center gap-6 rounded-lg border-2 border-dashed border-gray-300 p-16 text-center">
            <IconShoppingBag size={64} className="text-gray-400" />
            <h2 className="text-2xl font-semibold">V치코 ko코칤k je pr치zdn칳</h2>
            <p className="text-gray-600">Vypad치 to, 쬰 jste je코t캩 nic nep콏idali. Poj캞me to napravit!</p>
            <Button size="lg" onClick={() => navigateTo('product', 'fox')}>
              Prozkoumat Kolekci
            </Button>
          </div>
        ) : (
          // Pln칳 ko코칤k
          <div className="grid grid-cols-1 gap-12 lg:grid-cols-3">
            {/* Lev칳 sloupec - Produkty */}
            <div className="space-y-6 lg:col-span-2">
              <h2 className="text-2xl font-semibold">Produkty v ko코칤ku ({totalCartItems})</h2>
              <div className="space-y-4">
                {cart.map(item => {
                  // *** ZDE JE KL칈캛OV츼 칔PRAVA ***
                  const isCustom = item.type === 'custom';
                  // Sjednot칤me data, a콘 u jsou z PRODUCT_DATA nebo customDetails
                  const productData = isCustom ? item.customDetails : PRODUCT_DATA[item.id];
                  
                  // Z칤sk치me specifick칠 hodnoty
                  const imageUrl = isCustom ? productData.imageUrl : productData.images[0];
                  const productName = productData.name;
                  const productSubtitle = isCustom ? `Soubor: ${productData.fileName}` : productData.subtitle;
                  const itemPrice = isCustom ? productData.price : productData.price;
                  
                  return (
                    <Card key={item.id} className="flex flex-col gap-4 p-4 md:flex-row md:items-center">
                      <ImageWithFallback
                        src={imageUrl}
                        alt={productName}
                        className={`h-24 w-24 flex-shrink-0 rounded-md object-cover ${!isCustom && 'cursor-pointer'}`}
                        onClick={!isCustom ? () => navigateTo('product', item.id) : undefined}
                      />
                      <div className="flex-1 space-y-2">
                        <h3 
                          className={`text-lg font-medium ${!isCustom && 'cursor-pointer hover:underline'}`}
                          onClick={!isCustom ? () => navigateTo('product', item.id) : undefined}
                        >
                          {productName}
                        </h3>
                        <p className="text-sm text-gray-600">{productSubtitle}</p>
                        {/* Quantity controls */}
                        <div className="flex w-fit items-center rounded-md border">
                          <Button variant="ghost" size="icon" onClick={() => updateCartItemQuantity(item.id, item.quantity - 1)} className="h-9 w-9 rounded-r-none border-r" disabled={isCustom}>
                            <IconMinus size={14} />
                          </Button>
                          <span className="w-10 text-center text-base font-medium">{item.quantity}</span>
                          <Button variant="ghost" size="icon" onClick={() => updateCartItemQuantity(item.id, item.quantity + 1)} className="h-9 w-9 rounded-l-none border-l" disabled={isCustom}>
                            <IconPlus size={14} />
                          </Button>
                        </div>
                        {isCustom && <p className="text-xs text-gray-500">Mno쬽tv칤 zak치zkov칠ho tisku nelze m캩nit.</p>}
                      </div>
                      <div className="flex items-center gap-4 md:flex-col md:items-end">
                        <p className="text-lg font-semibold">{item.quantity * itemPrice} K캜</p>
                        <Button variant="ghost" size="icon" onClick={() => removeFromCart(item.id)}>
                          <IconTrash size={18} className="text-gray-600 hover:text-red-600" />
                        </Button>
                      </div>
                    </Card>
                  );
                })}
              </div>
            </div>
            
            {/* Prav칳 sloupec - Souhrn (bez 칰prav, `cartSubtotal` a `totalPrice` jsou ji upraveny v kontextu) */}
            <div className="lg:col-span-1">
              <div className="sticky top-28 space-y-6 rounded-lg bg-gray-50/70 p-6 shadow-sm">
                <h2 className="text-2xl font-semibold">Souhrn objedn치vky</h2>
                
                {/* Free shipping progress */}
                <div className="space-y-2">
                  <div className="flex items-center justify-between text-sm font-medium">
                    <div className="flex items-center gap-2">
                      <IconTruck size={16} />
                      {remainingForFreeShipping <= 0 ? (
                        <span className="text-green-600">Gratulujeme! Doprava zdarma!</span>
                      ) : (
                        <span>Zb칳v치 {remainingForFreeShipping} K캜 do dopravy zdarma!</span>
                      )}
                    </div>
                  </div>
                  <Progress value={freeShippingProgress} />
                </div>
                
                {/* Cenov칳 rozpis */}
                <div className="space-y-3 border-b pb-4">
                  <div className="flex justify-between text-gray-700">
                    <span>Mezisou캜et:</span>
                    <span>{cartSubtotal} K캜</span>
                  </div>
                  <div className="flex justify-between text-gray-700">
                    <span>Doprava:</span>
                    {shippingCost === 0 ? (
                      <span className="font-medium text-green-600">ZDARMA</span>
                    ) : (
                      <span>{shippingCost} K캜</span>
                    )}
                  </div>
                </div>
                
                <div className="flex justify-between text-xl font-bold">
                  <span>Celkem:</span>
                  <span>{totalPrice} K캜</span>
                </div>
                
                <Button size="lg" className="w-full" onClick={() => navigateTo('checkout')}>
                  Pokra캜ovat k doprav캩 a platb캩
                </Button>
                <Button variant="outline" className="w-full" onClick={() => navigateTo('product', 'fox')}>
                  Pokra캜ovat v n치kupu
                </Button>
              </div>
            </div>
          </div>
        )}
      </div>
    </React.Fragment>
  );
};

// *** UPRAVENO: Str치nka Checkout nyn칤 zobrazuje i zak치zkov칠 polo쬶y v souhrnu ***
const CheckoutPage = () => {
  const {
    navigateTo,
    shippingOptionId,
    selectShippingOption,
    selectedPickupPoint,
    selectPickupPoint,
    shippingAddress,
    setShippingAddress,
    showToast,
    submitOrder,
    cart,
    cartSubtotal,
    shippingCost,
    totalPrice,
    isSubmitting 
  } = useAppContext();
  
  // Stavy pro kontaktn칤 칰daje
  const [email, setEmail] = useState('');
  const [phone, setPhone] = useState('');

  const selectedOption = SHIPPING_OPTIONS_DATA.find(opt => opt.id === shippingOptionId);
  const isAddressDelivery = selectedOption?.type === 'address';
  
  // *** Zde pat콏칤 v치코 API kl칤캜 k Z치silkovn캩 ***
  const PACKETA_API_KEY = 'VASE_VEREJNE_API_ID_ZASILKOVNA';
  
  const handleOpenPacketaWidget = () => {
      if (!window.Packeta) {
        showToast("Chyba: Widget Z치silkovny se nenahr치l.");
        return;
      }
      
      try {
          Packeta.Widget.pick(PACKETA_API_KEY, (point) => {
            if (point) {
              console.log("Vybran칠 m칤sto (Z치silkovna):", point);
              selectPickupPoint(point);
            } else {
              console.log("U쬴vatel zav콏el widget Z치silkovny bez v칳b캩ru.");
            }
          }, {
             language: 'cs',
             country: 'cz',
          });
      } catch (e) {
          console.error("Chyba p콏i otev칤r치n칤 Packeta widgetu:", e);
          showToast("Chyba p콏i otev칤r치n칤 widgetu Z치silkovny.");
      }
  };
  
  const handleOpenBalikovnaWidget = () => {
      if (!window.Balikovna) {
        showToast("Chyba: Widget Bal칤kovny se nenahr치l.");
        return;
      }

      try {
          const callback = (data) => {
            if (data && data.id) {
                const mappedPoint = {
                    id: data.id,
                    name: data.name,
                    street: data.street,
                    city: data.city,
                    zip: data.postcode,
                };
                console.log("Vybran칠 m칤sto (Bal칤kovna JS):", mappedPoint);
                selectPickupPoint(mappedPoint);
            } else {
                console.log("U쬴vatel zav콏el widget Bal칤kovny (JS) bez v칳b캩ru.");
            }
          };
          
          Balikovna.vybrat(callback);

      } catch (e) {
          console.error("Chyba p콏i otev칤r치n칤 Balikovna widgetu (JS):", e);
          showToast("Chyba p콏i otev칤r치n칤 widgetu Bal칤kovny.");
      }
  };

  
  const handleSimulateSubmitOrder = () => {
    // Validace
    if (!email || !phone) {
        showToast('Pros칤m vypl켿te e-mail a telefon');
        return;
    }

    if (isAddressDelivery) {
      if (!shippingAddress.city || !shippingAddress.zip || !shippingAddress.street || !shippingAddress.number) {
        showToast('Pros칤m vypl켿te v코echny adresn칤 칰daje');
        return;
      }
    } else {
      if (!selectedPickupPoint) {
        showToast('Pros칤m vyberte v칳dejn칤 m칤sto');
        return;
      }
    }
    
    // Sestaven칤 dat pro odesl치n칤
    const contactDetails = {
        email,
        phone,
        address: isAddressDelivery ? shippingAddress : null
    };
    
    // `cart` ji obsahuje v코echny pot콏ebn칠 informace
    const orderDetails = {
        items: cart,
        subtotal: cartSubtotal,
        shippingCost: shippingCost,
        total: totalPrice
    };

    const selectedShipping = SHIPPING_OPTIONS_DATA.find(opt => opt.id === shippingOptionId);
    
    const selectedPickup = selectedPickupPoint;

    // Vol치n칤 nov칠 funkce pro odesl치n칤
    submitOrder(contactDetails, orderDetails, selectedShipping, selectedPickup);
  };
  
  const handleAddressChange = (e) => {
    setShippingAddress({ [e.target.name]: e.target.value });
  };
  
  return (
    <React.Fragment>
      <section className="bg-black text-white">
        <div className="container mx-auto max-w-7xl px-4 py-12 text-center">
          <h1 className="text-4xl font-bold tracking-tighter">Doprava a Platba</h1>
        </div>
      </section>
      
      <div className="container mx-auto max-w-7xl px-4 py-12">
        {cart.length === 0 ? (
            <div className="flex flex-col items-center justify-center gap-6 rounded-lg border-2 border-dashed border-gray-300 p-16 text-center">
                <IconShoppingBag size={64} className="text-gray-400" />
                <h2 className="text-2xl font-semibold">V치코 ko코칤k je pr치zdn칳</h2>
                <p className="text-gray-600">Nelze pokra캜ovat k pokladn캩 bez produkt콢.</p>
                <Button size="lg" onClick={() => navigateTo('home')}>
                    Zp캩t na domovskou str치nku
                </Button>
            </div>
        ) : (
            <div className="grid grid-cols-1 gap-12 lg:grid-cols-3">
            {/* Lev칳 sloupec - Formul치콏e (beze zm캩ny) */}
            <div className="space-y-8 lg:col-span-2">
                
                {/* Kontaktn칤 칰daje */}
                <section>
                    <h2 className="mb-4 text-2xl font-semibold">1. Kontaktn칤 칰daje</h2>
                    <Card className="bg-gray-50/70">
                        <CardContent className="pt-6 space-y-4">
                            <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
                                <div>
                                    <Label htmlFor="email">E-mail (povinn칠)</Label>
                                    <Input id="email" name="email" type="email" value={email} onChange={(e) => setEmail(e.target.value)} />
                                </div>
                                <div>
                                    <Label htmlFor="phone">Telefon (povinn칠)</Label>
                                    <Input id="phone" name="phone" type="tel" value={phone} onChange={(e) => setPhone(e.target.value)} />
                                </div>
                            </div>
                        </CardContent>
                    </Card>
                </section>

                {/* V칳b캩r dopravy */}
                <section>
                <h2 className="mb-4 text-2xl font-semibold">2. V칳b캩r dopravy</h2>
                <RadioGroup
                    value={shippingOptionId || ''}
                    onValueChange={selectShippingOption}
                    name="shippingOption"
                >
                    {SHIPPING_OPTIONS_DATA.map(option => (
                    <RadioGroupItem key={option.id} value={option.id} id={option.id}>
                        <div className="flex w-full items-center justify-between">
                        <div className="flex items-center gap-3">
                            <span className="flex items-center gap-1.5 text-lg">{option.icon}</span>
                            <span className="font-medium">{option.name}</span>
                        </div>
                        <span className="font-semibold">{option.price === 0 ? 'ZDARMA' : `${option.price} K캜`}</span>
                        </div>
                    </RadioGroupItem>
                    ))}
                </RadioGroup>
                </section>
                
                {/* Doru캜ovac칤 칰daje */}
                <section>
                <h2 className="mb-4 text-2xl font-semibold">3. Doru캜ovac칤 칰daje</h2>
                {isAddressDelivery ? (
                    // Formul치콏 pro adresu
                    <Card className="bg-gray-50/70">
                    <CardHeader>
                        <CardTitle>Doru캜ovac칤 adresa (povinn칠)</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
                        <div className="sm:col-span-2">
                            <Label htmlFor="city">M캩sto</Label>
                            <Input id="city" name="city" value={shippingAddress.city} onChange={handleAddressChange} />
                        </div>
                        <div>
                            <Label htmlFor="zip">PS캛</Label>
                            <Input id="zip" name="zip" value={shippingAddress.zip} onChange={handleAddressChange} />
                        </div>
                        </div>
                        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
                        <div className="sm:col-span-2">
                            <Label htmlFor="street">Ulice</Label>
                            <Input id="street" name="street" value={shippingAddress.street} onChange={handleAddressChange} />
                        </div>
                        <div>
                            <Label htmlFor="number">캛칤slo popisn칠</Label>
                            <Input id="number" name="number" value={shippingAddress.number} onChange={handleAddressChange} />
                        </div>
                        </div>
                    </CardContent>
                    </Card>
                ) : (
                    // V칳b캩r v칳dejn칤ho m칤sta
                    <Card className="bg-gray-50/70">
                    <CardHeader>
                        <CardTitle>Vyberte v칳dejn칤 m칤sto (povinn칠)</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        
                        {/* Podm칤n캩n치 tla캜칤tka pro widgety */}
                        {shippingOptionId === 'zasil_box' && (
                            <Button className="w-full" size="lg" onClick={handleOpenPacketaWidget}>
                                <IconPost className="mr-2" /> Vybrat Z-Box / V칳dejn칤 m칤sto
                            </Button>
                        )}
                        {shippingOptionId === 'balik_box' && (
                            <Button className="w-full" size="lg" onClick={handleOpenBalikovnaWidget}>
                                <IconPackage className="mr-2" /> Vybrat Bal칤kovnu
                            </Button>
                        )}
                        
                        {/* Zobrazen칤 vybran칠ho m칤sta (spole캜n칠 pro v코echny) */}
                        {selectedPickupPoint ? (
                            <div className="mt-4 rounded-lg border bg-white p-4 ring-2 ring-green-500">
                                <div className="flex justify-between items-center">
                                    <p className="text-sm font-medium text-green-700">Vybran칠 m칤sto:</p>
                                    <Button variant="link" size="sm" className="p-0 text-red-600 h-auto" onClick={() => selectPickupPoint(null)}>
                                        Zm캩nit
                                    </Button>
                                </div>
                                <p className="mt-1 font-semibold">{selectedPickupPoint.name}</p>
                                <p className="text-sm text-gray-600">{selectedPickupPoint.street}</p>
                                <p className="text-sm text-gray-600">{selectedPickupPoint.zip} {selectedPickupPoint.city}</p>
                            </div>
                        ) : (
                            !isAddressDelivery && (
                                <div className="mt-4 text-sm text-gray-600">
                                    Pros칤m, vyberte v칳dejn칤 m칤sto kliknut칤m na tla캜칤tko v칳코e.
                                </div>
                            )
                        )}
                        
                    </CardContent>
                    </Card>
                )}
                </section>
            </div>
            
            {/* Prav칳 sloupec - Souhrn */}
            <div className="lg:col-span-1">
                <div className="sticky top-28 space-y-6 rounded-lg bg-gray-50/70 p-6 shadow-sm">
                <h2 className="text-2xl font-semibold">Souhrn objedn치vky</h2>
                
                {/* Miniatury produkt콢 */}
                <div className="space-y-3 border-b pb-4">
                    {cart.map(item => {
                      // *** ZDE JE KL칈캛OV츼 칔PRAVA ***
                      const isCustom = item.type === 'custom';
                      const productData = isCustom ? item.customDetails : PRODUCT_DATA[item.id];
                      const imageUrl = isCustom ? productData.imageUrl : productData.images[0];
                      const productName = productData.name;
                      const itemPrice = isCustom ? productData.price : PRODUCT_DATA[item.id].price;

                      return (
                        <div key={item.id} className="flex items-center gap-3">
                        <ImageWithFallback
                            src={imageUrl}
                            alt={productName}
                            className="h-12 w-12 rounded-md object-cover border"
                        />
                        <div className="flex-1 text-sm">
                            <div className="font-medium">{productName}</div>
                            <div className="text-gray-600">Mno쬽tv칤: {item.quantity}</div>
                        </div>
                        <div className="text-sm font-semibold">{item.quantity * itemPrice} K캜</div>
                        </div>
                      );
                    })}
                </div>
                
                {/* Cenov칳 rozpis */}
                <div className="space-y-3 border-b pb-4">
                    <div className="flex justify-between text-gray-700">
                    <span>Mezisou캜et:</span>
                    <span>{cartSubtotal} K캜</span>
                    </div>
                    <div className="flex justify-between text-gray-700">
                    <span>Doprava:</span>
                    <span className="font-medium">{shippingCost === 0 ? 'ZDARMA' : `${shippingCost} K캜`}</span>
                    </div>
                </div>
                
                <div className="flex justify-between text-xl font-bold">
                    <span>Celkem:</span>
                    <span>{totalPrice} K캜</span>
                </div>
                
                <Button 
                    size="lg" 
                    className="w-full" 
                    onClick={handleSimulateSubmitOrder} 
                    disabled={isSubmitting}
                >
                    {isSubmitting ? 'Odes칤l치m...' : 'Odeslat objedn치vku'}
                </Button>

                <Button variant="outline" className="w-full" onClick={() => navigateTo('cart')}>
                    Zp캩t do ko코칤ku
                </Button>
                <p className="text-xs text-gray-600 text-center">
                    Kliknut칤m na "Odeslat objedn치vku" bude objedn치vka zaznamen치na a obdr쮂셦e potvrzovac칤 e-mail.
                </p>
                </div>
            </div>
            </div>
        )}
      </div>

    </React.Fragment>
  );
};

// *** UPRAVENO: Str치nka potvrzen칤 nyn칤 zobrazuje i zak치zkov칠 polo쬶y ***
const ConfirmationPage = () => {
    const { orderConfirmation, navigateTo } = useAppContext();

    if (!orderConfirmation) {
        React.useEffect(() => {
            navigateTo('home');
        }, [navigateTo]);
        return null;
    }

    const { orderId, contact, order, shippingOption, pickupPoint } = orderConfirmation;
    const isAddressDelivery = !!contact.address;

    return (
        <React.Fragment>
            <section className="bg-green-600 text-white">
                <div className="container mx-auto max-w-7xl px-4 py-16 text-center">
                    <IconCheckCircle size={64} className="mx-auto" />
                    <h1 className="mt-6 text-4xl font-bold tracking-tighter">Objedn치vka potvrzena!</h1>
                    <p className="mt-4 text-lg text-green-100">
                        D캩kujeme za v치코 n치kup. Shrnut칤 jsme v치m pr치v캩 odeslali na e-mail.
                    </p>
                </div>
            </section>

            <section className="container mx-auto max-w-3xl px-4 py-16">
                <div className="space-y-8 rounded-lg border bg-gray-50/70 p-8 shadow-sm">
                    <h2 className="text-center text-2xl font-semibold">
                        Souhrn objedn치vky 캜. <span className="text-green-600">{orderId}</span>
                    </h2>

                    {/* Shrnut칤 produkt콢 */}
                    <div className="space-y-4 border-b pb-6">
                        <h3 className="text-lg font-medium">Polo쬶y</h3>
                        {/* `order.items` je zde pole `CartItem` */}
                        {order.items.map(item => {
                            // *** ZDE JE KL칈캛OV츼 칔PRAVA ***
                            const isCustom = item.type === 'custom';
                            const productData = isCustom ? item.customDetails : PRODUCT_DATA[item.id];
                            const imageUrl = isCustom ? productData.imageUrl : productData.images[0];
                            const productName = productData.name;
                            const pricePerItem = isCustom ? productData.price : PRODUCT_DATA[item.id].price;

                            return (
                                <div key={item.id} className="flex items-center gap-4">
                                    <ImageWithFallback
                                        src={imageUrl}
                                        alt={productName}
                                        className="h-16 w-16 rounded-md object-cover border"
                                    />
                                    <div className="flex-1 text-sm">
                                        <div className="font-medium">{productName}</div>
                                        {isCustom && <div className="text-gray-600 text-xs">Soubor: {productData.fileName}</div>}
                                        {isCustom && <div className="text-gray-600 text-xs">Materi치l: {productData.material}</div>}
                                        <div className="text-gray-600">Mno쬽tv칤: {item.quantity}</div>
                                    </div>
                                    <div className="text-sm font-semibold">{item.quantity * pricePerItem} K캜</div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Ceny (beze zm캩ny, `order` objekt m치 ji spr치vn칠 sou캜ty) */}
                    <div className="space-y-3 border-b pb-6">
                         <div className="flex justify-between text-gray-700">
                            <span>Mezisou캜et:</span>
                            <span>{order.subtotal} K캜</span>
                        </div>
                        <div className="flex justify-between text-gray-700">
                            <span>Doprava ({shippingOption?.name || 'N/A'}):</span>
                            <span className="font-medium">{order.shippingCost === 0 ? 'ZDARMA' : `${order.shippingCost} K캜`}</span>
                        </div>
                        <div className="flex justify-between text-xl font-bold">
                            <span>Celkem zaplaceno:</span>
                            <span>{order.total} K캜</span>
                        </div>
                    </div>

                    {/* Doru캜ovac칤 칰daje (beze zm캩ny) */}
                    <div className="space-y-4">
                        <h3 className="text-lg font-medium">Doru캜ovac칤 칰daje</h3>
                        <div className="text-gray-700">
                            <p><strong>E-mail:</strong> {contact.email}</p>
                            <p><strong>Telefon:</strong> {contact.phone}</p>
                        </div>
                        {isAddressDelivery ? (
                            <div className="text-gray-700">
                                <p className="font-medium">Doru캜en칤 na adresu:</p>
                                <p>{contact.address.street} {contact.address.number}</p>
                                <p>{contact.address.zip} {contact.address.city}</p>
                            </div>
                        ) : (
                             <div className="text-gray-700">
                                <p className="font-medium">Vyzvednut칤 na m칤st캩:</p>
                                <p><strong>{pickupPoint?.name}</strong></p>
                                <p>{pickupPoint?.street}</p>
                                <p>{pickupPoint?.zip} {pickupPoint?.city}</p>
                            </div>
                        )}
                    </div>

                    {/* Tla캜칤tko zp캩t dom콢 */}
                    <div className="pt-6 text-center">
                        <Button size="lg" onClick={() => navigateTo('home')}>
                            Zp캩t na domovskou str치nku
                        </Button>
                    </div>
                </div>
            </section>
        </React.Fragment>
    );
};


// Str치nka Kontaktu (beze zm캩ny)
const ContactPage = () => {
  const { navigateTo, showToast } = useAppContext();
  
  const handleSubmit = (e) => {
    e.preventDefault();
    showToast("V치코 dotaz byl 칰sp캩코n캩 odesl치n!");
  };
  
  return (
    <React.Fragment>
      <section className="bg-black text-white">
        <div className="container mx-auto max-w-7xl px-4 py-16 text-center">
          <h1 className="text-4xl font-bold tracking-tighter">Kontaktujte N치s</h1>
          <p className="mt-4 text-lg text-gray-300">
            M치te dotaz nebo speci치ln칤 po쬬davek? R치di v치m pom콢쬰me!
          </p>
        </div>
      </section>
      
      <section className="container mx-auto max-w-7xl px-4 py-16 md:py-24">
        <div className="grid grid-cols-1 gap-12 md:grid-cols-2">
          {/* Formul치콏 */}
          <form onSubmit={handleSubmit} className="space-y-6">
            <h2 className="text-3xl font-bold">Napi코te n치m</h2>
            <div className="space-y-4">
              <div>
                <Label htmlFor="name">Jm칠no</Label>
                <Input id="name" name="name" type="text" required />
              </div>
              <div>
                <Label htmlFor="email">E-mail</Label>
                <Input id="email" name="email" type="email" required />
              </div>
              <div>
                <Label htmlFor="message">Zpr치va</Label>
                <Textarea id="message" name="message" rows={6} required />
              </div>
            </div>
            <Button type="submit" size="lg">
              Odeslat Dotaz <IconSend className="ml-2" />
            </Button>
          </form>
          
          {/* Info */}
          <div className="space-y-8">
            {/* P콏칤m칠 kontakty */}
            <div>
              <h3 className="text-2xl font-semibold mb-4">P콏칤m칠 kontakty</h3>
              <div className="flex items-center gap-4">
                <div className="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-black text-white">
                  <IconMail size={24} />
                </div>
                <div>
                  <Label>E-mail</Label>
                  <a href="mailto:sf.simonflorian@gmail.com" className="block text-lg font-medium text-black hover:underline">
                    sf.simonflorian@gmail.com
                  </a>
                </div>
              </div>
            </div>
            
            {/* FAQ */}
            <div className="rounded-lg bg-gray-50/70 p-6">
              <h3 className="text-2xl font-semibold mb-4">캛asto kladen칠 dotazy</h3>
              <div className="space-y-4">
                <div>
                  <h4 className="font-medium">Jak dlouho trv치 dod치n칤?</h4>
                  <p className="text-gray-700">Objedn치vky odes칤l치me obvykle do 24 hodin. Dod치n칤 pak trv치 1-3 pracovn칤 dny.</p>
                </div>
                <div>
                  <h4 className="font-medium">Mohu vr치tit zbo쮂?</h4>
                  <p className="text-gray-700">Ano, na vr치cen칤 zbo쮂 bez ud치n칤 d콢vodu m치te 30 dn칤.</p>
                </div>
                <div>
                  <h4 className="font-medium">Vyr치b칤te i jin칠 motivy?</h4>
                  <p className="text-gray-700">M치me v pl치nu roz코i콏ovat kolekci. Pro speci치ln칤 po쬬davky n치m napi코te!</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      {/* CTA sekce */}
      <section className="bg-gray-50/70 py-16 md:py-24">
        <div className="container mx-auto max-w-3xl px-4 text-center">
          <h2 className="text-3xl font-bold tracking-tighter md:text-4xl">M치te z치jem o na코e produkty?</h2>
          <p className="mt-4 text-lg text-gray-600">
            Prohl칠dn캩te si na코i kompletn칤 kolekci 3D ti코t캩n칳ch p콏칤v캩sk콢.
          </p>
          <Button size="lg" className="mt-8" onClick={() => navigateTo('product', 'fox')}>
            Prozkoumat Kolekci
          </Button>
        </div>
      </section>
    </React.Fragment>
  );
};

// Str치nka o 3D tisku (beze zm캩ny)
const PrintingInfoPage = () => {
  const { navigateTo } = useAppContext();
  
  return (
    <React.Fragment>
      <section className="bg-black text-white">
        <div className="container mx-auto max-w-7xl px-4 py-16 text-center">
          <div className="mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-white text-black">
            <IconPrinter size={40} />
          </div>
          <h1 className="mt-6 text-4xl font-bold tracking-tighter">Jak 3D Tisk Funguje</h1>
          <p className="mt-4 text-lg text-gray-300">
            Modern칤 technologie, kter치 vyr치b칤 na코e p콏칤v캩sky s neuv캩콏itelnou p콏esnost칤.
          </p>
        </div>
      </section>
      
      {/* Co je 3D tisk */}
      <section className="container mx-auto max-w-7xl px-4 py-16 md:py-24">
        <div className="mx-auto max-w-3xl text-center">
          <h2 className="text-3xl font-bold tracking-tighter md:text-4xl">Co je 3D Tisk?</h2>
          <p className="mt-4 text-lg text-gray-600">
            3D tisk, zn치m칳 tak칠 jako aditivn칤 v칳roba, je proces vytv치콏en칤 trojrozm캩rn칳ch objekt콢 z digit치ln칤ho souboru. Na rozd칤l od tradi캜n칤ch metod, kde se materi치l odeb칤r치, 3D tisk stav칤 objekt vrstvu po vrstv캩.
          </p>
        </div>
        <div className="mt-12 grid grid-cols-1 gap-8 md:grid-cols-3">
          <div className="rounded-lg bg-gray-50/70 p-6 text-center">
            <div className="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-black text-white">
              <IconLayers size={28} />
            </div>
            <h3 className="mt-4 text-xl font-semibold">Vrstven칤 po vrstv치ch</h3>
            <p className="mt-2 text-gray-600">P콏esnost a 0,1 mm na vrstvu pro dokonal칠 detaily.</p>
          </div>
          <div className="rounded-lg bg-gray-50/70 p-6 text-center">
            <div className="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-black text-white">
              <IconZap size={28} />
            </div>
            <h3 className="mt-4 text-xl font-semibold">Rychl치 v칳roba</h3>
            <p className="mt-2 text-gray-600">Jeden p콏칤v캩sek je hotov칳 p콏ibli쬹캩 za 15-30 minut.</p>
          </div>
          <div className="rounded-lg bg-gray-50/70 p-6 text-center">
            <div className="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-black text-white">
              <IconLeaf size={28} />
            </div>
            <h3 className="mt-4 text-xl font-semibold">Ekologick칳 PLA</h3>
            <p className="mt-2 text-gray-600">Biologicky odbourateln칳 bioplast z kuku콏ice.</p>
          </div>
        </div>
      </section>

      {/* Proces v칳roby */}
      <section className="bg-gray-50/70 py-16 md:py-24">
        <div className="container mx-auto max-w-7xl px-4">
          <div className="mx-auto max-w-3xl text-center">
            <h2 className="text-3xl font-bold tracking-tighter md:text-4xl">Proces V칳roby</h2>
            <p className="mt-4 text-lg text-gray-600">Od digit치ln칤ho modelu k fyzick칠mu p콏칤v캩sku.</p>
          </div>
          <div className="mt-12 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4">
            <Card>
              <CardHeader><CardTitle>01 - 3D Model</CardTitle></CardHeader>
              <CardContent><p className="text-sm text-gray-700">Vytvo콏칤me digit치ln칤 model v softwaru (Fusion 360, Blender).</p></CardContent>
            </Card>
            <Card>
              <CardHeader><CardTitle>02 - Slicov치n칤</CardTitle></CardHeader>
              <CardContent><p className="text-sm text-gray-700">Model je "nakr치jen" na vrstvy v Bambu Studio.</p></CardContent>
            </Card>
            <Card>
              <CardHeader><CardTitle>03 - 3D Tisk</CardTitle></CardHeader>
              <CardContent><p className="text-sm text-gray-700">Tisk치rna tav칤 PLA filament a nan치코칤 vrstvu po vrstv캩.</p></CardContent>
            </Card>
            <Card>
              <CardHeader><CardTitle>04 - Dokon캜en칤</CardTitle></CardHeader>
              <CardContent><p className="text-sm text-gray-700">Ka쬯치 vrstva chladne, tuhne a p콏칤v캩sek je hotov.</p></CardContent>
            </Card>
          </div>
        </div>
      </section>
      
      {/* Tisk치rna */}
      <section className="container mx-auto max-w-7xl px-4 py-16 md:py-24">
        <div className="grid grid-cols-1 items-center gap-12 md:grid-cols-2">
          <div>
            <h2 className="text-3xl font-bold tracking-tighter md:text-4xl">Tisk치rna Bambu Lab P1S</h2>
            <p className="mt-4 text-lg text-gray-600">
              Pro na코e produkty spol칠h치me na profesion치ln칤 tisk치rnu Bambu Lab P1S, kter치 je 코pi캜kou v oboru. Zaru캜uje neuv캩콏itelnou rychlost, spolehlivost a d칤ky AMS syst칠mu i perfektn칤 v칤cebarevn칳 tisk.
            </p>
            <Card className="mt-6 bg-gray-50/70">
              <CardHeader><CardTitle>Technick칠 specifikace</CardTitle></CardHeader>
              <CardContent className="space-y-2 text-sm">
                {[
                  "Tisk치rna: Bambu Lab P1S",
                  "P콏esnost vrstvy: 0,05 - 0,35 mm",
                  "Rychlost tisku: a 500 mm/s",
                  "V칤cebarevn칳 tisk: Ano (s AMS)"
                ].map(item => (
                  <div key={item} className="flex items-center gap-2">
                    <IconCheck className="text-green-600" />
                    <span>{item}</span>
                  </div>
                ))}
              </CardContent>
            </Card>
          </div>
          <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
            <ImageWithFallback src={IMAGES.printer_image} alt="Tisk치rna Bambu Lab P1S" className="aspect-video w-full rounded-lg object-cover shadow-md" />
            <ImageWithFallback src={IMAGES.filament_image} alt="Barevn칠 PLA filamenty" className="aspect-video w-full rounded-lg object-cover shadow-md" />
          </div>
        </div>
      </section>

      {/* Pro캜 PLA */}
      <section className="bg-black text-white">
        <div className="container mx-auto max-w-5xl px-4 py-16 md:py-24 text-center">
          <div className="mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-white text-black">
            <IconLeaf size={40} />
          </div>
          <h2 className="mt-6 text-3xl font-bold tracking-tighter md:text-4xl">Pro캜 PLA Filament?</h2>
          <p className="mt-4 text-lg text-gray-300">
            PLA je ekologick칳 bioplast vyroben칳 z obnoviteln칳ch zdroj콢, jako je kuku콏ice nebo cukrov치 t콏tina. Je biologicky odbourateln칳, netoxick칳 a bez z치pachu p콏i tisku.
          </p>
          <p className="mt-4 text-lg text-gray-300">
            Z치rove켿 je pevn칳, lehk칳 a nab칤z칤 쬴v칠, syt칠 barvy, co z n캩j 캜in칤 ide치ln칤 materi치l pro detailn칤 p콏칤v캩sky.
          </p>
        </div>
      </section>

      {/* CTA */}
      <section className="py-16 md:py-24">
        <div className="container mx-auto max-w-3xl px-4 text-center">
          <h2 className="text-3xl font-bold tracking-tighter md:text-4xl">P콏esv캩d캜te se sami o kvalit캩 3D tisku</h2>
          <p className="mt-4 text-lg text-gray-600">
            Ka쬯칳 p콏칤v캩sek je vyroben s maxim치ln칤 p칠캜칤 o detail.
          </p>
          <Button size="lg" className="mt-8" onClick={() => navigateTo('product', 'fox')}>
            Prozkoumat Kolekci
          </Button>
        </div>
      </section>
    </React.Fragment>
  );
};


// *** NOVINKA: Str치nka pro zak치zkov칳 tisk ***
const CustomPrintPage = () => {
  const { addCustomItemToCart, showToast } = useAppContext();
  const [file, setFile] = useState(null);
  const [dragOver, setDragOver] = useState(false);
  const [isCalculating, setIsCalculating] = useState(false);
  const [calcResult, setCalcResult] = useState(null); // { volumeCm3, weightG, timeH, materialCost, timeCost, totalPrice }
  
  // Nastaven칤 tisku
  const [material, setMaterial] = useState('PLA');
  // *** ZM캨NA: P콏id치n stav pro barvu ***
  const [color, setColor] = useState('cerna'); // V칳choz칤 barva
  const [quality, setQuality] = useState(0.2); // 0.2mm (Standard)
  
  // Cen칤k (m콢쬰te si ho upravit)
  const PRICE_SETUP_FEE = 50; // K캜, z치kladn칤 poplatek za p콏칤pravu
  // *** ZM캨NA: Cena PLA upravena na 2.0 K캜/g ***
  const PRICE_PER_GRAM_PLA = 2.0; // K캜/g
  const PRICE_PER_GRAM_PETG = 3.0; // K캜/g
  const PRICE_PER_HOUR = 30; // K캜/h
  
  const DENSITY_PLA = 1.24; // g/cm췁
  const DENSITY_PETG = 1.27; // g/cm췁

  // *** ZM캨NA: Rychlosti tisku upraveny podle po쬬davku ***
  const PRINT_SPEEDS = {
      // 0.1: 10, // Odebr치no
      0.2: 18, // Standardn칤 kvalita
      // 0.3: 25, // Odebr치no
      0.4: 35, // Rychl치 kvalita (Nov칠) - odhad
  };
  
  const fileInputRef = React.useRef(null);
  
  // Funkce pro v칳po캜et objemu modelu
  const calculateVolume = (geometry) => {
      if (!geometry.isBufferGeometry) {
          console.error("Geometrie nen칤 BufferGeometry");
          return 0;
      }
      
      const positions = geometry.attributes.position.array;
      let volume = 0;
      
      const p1 = new THREE.Vector3();
      const p2 = new THREE.Vector3();
      const p3 = new THREE.Vector3();
      
      for (let i = 0; i < positions.length; i += 9) {
          p1.set(positions[i], positions[i+1], positions[i+2]);
          p2.set(positions[i+3], positions[i+4], positions[i+5]);
          p3.set(positions[i+6], positions[i+7], positions[i+8]);
          
          // V칳po캜et objemu tetraedru (orientovan칠ho)
          volume += p1.dot(p2.clone().cross(p3)) / 6.0;
      }
      
      // STL je 캜asto v mm^3, p콏evedeme na cm^3
      return Math.abs(volume / 1000.0);
  };
  
  // Funkce pro zpracov치n칤 nahran칠ho souboru
  const processFile = (uploadedFile) => {
      if (!uploadedFile) return;
      
      // Podporujeme pouze .stl
      if (!uploadedFile.name.toLowerCase().endsWith('.stl')) {
          showToast('Chyba: Podporov치ny jsou pouze soubory .stl');
          return;
      }
      
      setFile(uploadedFile);
      setIsCalculating(true);
      setCalcResult(null);
      
      const reader = new FileReader();
      
      reader.onload = (event) => {
          try {
              const contents = event.target.result;
              const loader = new THREE.STLLoader();
              const geometry = loader.parse(contents);
              
              const volumeCm3 = calculateVolume(geometry);
              
              if (volumeCm3 === 0) {
                  throw new Error("Nepoda콏ilo se vypo캜칤tat objem modelu.");
              }

              // Spu코t캩n칤 kalkulace ceny
              calculatePrice(volumeCm3, uploadedFile.name);

          } catch (error) {
              console.error("Chyba p콏i parsov치n칤 STL:", error);
              showToast("Chyba p콏i zpracov치n칤 .stl souboru. Je soubor validn칤?");
              setIsCalculating(false);
              setFile(null);
          }
      };
      
      reader.onerror = () => {
          showToast("Chyba p콏i 캜ten칤 souboru.");
          setIsCalculating(false);
          setFile(null);
      };
      
      reader.readAsArrayBuffer(uploadedFile);
  };
  
  // Funkce pro v칳po캜et ceny (spou코t칤 se po v칳po캜tu objemu)
  const calculatePrice = (volumeCm3, fileName) => {
      const density = material === 'PLA' ? DENSITY_PLA : DENSITY_PETG;
      const pricePerGram = material === 'PLA' ? PRICE_PER_GRAM_PLA : PRICE_PER_GRAM_PETG;
      const speed = PRINT_SPEEDS[quality];
      
      // Kontrola pro p콏칤pad, 쬰 by kvalita nebyla v PRINT_SPEEDS
      if (!speed) {
          showToast("Chyba: Neplatn치 kvalita tisku.");
          setIsCalculating(false);
          return;
      }

      const weightG = volumeCm3 * density;
      const materialCost = weightG * pricePerGram;
      
      const timeH = volumeCm3 / speed;
      const timeCost = timeH * PRICE_PER_HOUR;
      
      const totalPrice = PRICE_SETUP_FEE + materialCost + timeCost;
      
      setCalcResult({
          fileName: fileName,
          volumeCm3: volumeCm3,
          weightG: weightG,
          timeH: timeH,
          materialCost: materialCost,
          timeCost: timeCost,
          totalPrice: Math.ceil(totalPrice), // Zaokrouhl칤me nahoru na cel칠 K캜
      });
      setIsCalculating(false);
  };
  
  // P콏epo캜칤t치n칤 ceny p콏i zm캩n캩 nastaven칤
  useEffect(() => {
      if (calcResult && file) {
          // M치me ji vypo캜ten칳 objem, sta캜칤 p콏epo캜칤tat cenu
          setIsCalculating(true);
          // Kr치tk치 pauza pro UI
          setTimeout(() => {
              calculatePrice(calcResult.volumeCm3, calcResult.fileName);
          }, 100);
      }
  }, [material, quality]); // Sledujeme zm캩ny materi치lu a kvality
  

  const handleDragEvents = (e, isOver) => {
      e.preventDefault();
      e.stopPropagation();
      setDragOver(isOver);
  };
  
  const handleDrop = (e) => {
      handleDragEvents(e, false);
      const droppedFile = e.dataTransfer.files[0];
      if (droppedFile) {
          processFile(droppedFile);
      }
  };
  
  const handleFileChange = (e) => {
      const selectedFile = e.target.files[0];
      if (selectedFile) {
          processFile(selectedFile);
      }
  };

  const handleAddToCart = () => {
      if (!calcResult || !file) return;

      // *** ZM캨NA: P콏id치na barva do `material` popisu ***
      const selectedColor = PLA_COLORS.find(c => c.id === color)?.name || color;
      const materialDescription = material === 'PLA' ? `PLA (${selectedColor})` : 'PETG';

      const customItem = {
          id: `custom_${new Date().getTime()}`, // Unik치tn칤 ID
          quantity: 1,
          type: 'custom',
          customDetails: {
              name: "Zak치zkov칳 3D tisk",
              price: calcResult.totalPrice,
              fileName: calcResult.fileName,
              volumeCm3: calcResult.volumeCm3,
              material: materialDescription, // Ulo쮂셠e fin치ln칤 popis materi치lu
              imageUrl: IMAGES.custom_print_placeholder,
          }
      };
      
      addCustomItemToCart(customItem);
      
      // Reset formul치콏e
      setFile(null);
      setCalcResult(null);
      setMaterial('PLA');
      setQuality(0.2);
      setColor('cerna'); // Reset barvy
      if(fileInputRef.current) {
          fileInputRef.current.value = null;
      }
  };

  return (
    <React.Fragment>
      <section 
        className="bg-gray-900 bg-cover bg-center"
        style={{ backgroundImage: `url(${IMAGES.custom_print_hero})` }}
      >
        <div className="bg-black bg-opacity-60">
            <div className="container mx-auto max-w-7xl px-4 py-16 text-center text-white">
                <IconCube size={64} className="mx-auto" />
                <h1 className="mt-6 text-4xl font-bold tracking-tighter">Zak치zkov칳 3D tisk</h1>
                <p className="mt-4 text-lg text-gray-200">
                    Nahrajte sv콢j .stl model a z칤skejte okam쬴tou cenovou kalkulaci.
                </p>
            </div>
        </div>
      </section>
      
      <section className="container mx-auto max-w-7xl px-4 py-16">
        <div className="grid grid-cols-1 gap-12 lg:grid-cols-2">
            
            {/* Lev치 strana - Upload a Nastaven칤 */}
            <div className="space-y-8">
                {/* 1. Krok - Upload */}
                <Card>
                    <CardHeader>
                        <CardTitle className="text-2xl">1. Nahrajte v치코 model</CardTitle>
                        <CardDescription>Podporujeme pouze soubory ve form치tu .stl</CardDescription>
                    </CardHeader>
                    <CardContent>
                        <input
                            type="file"
                            accept=".stl"
                            onChange={handleFileChange}
                            ref={fileInputRef}
                            className="hidden"
                            id="file-upload"
                        />
                        <div
                            className={`file-upload-area ${dragOver ? 'drag-over' : ''}`}
                            onClick={() => fileInputRef.current && fileInputRef.current.click()}
                            onDragOver={(e) => handleDragEvents(e, true)}
                            onDragLeave={(e) => handleDragEvents(e, false)}
                            onDrop={handleDrop}
                        >
                            <IconUploadCloud size={48} className="mx-auto text-gray-400" />
                            <p className="mt-4 font-semibold text-black">Klikn캩te nebo p콏et치hn캩te soubor sem</p>
                            <p className="text-sm text-gray-600">Maxim치ln칤 velikost souboru: 25 MB</p>
                        </div>
                        
                        {file && !isCalculating && calcResult && (
                             <div className="mt-4 flex items-center gap-3 rounded-lg border bg-gray-50 p-4">
                                <IconFile size={32} className="text-green-600 flex-shrink-0" />
                                <div className="flex-1">
                                    <p className="font-medium text-black truncate">{file.name}</p>
                                    <p className="text-sm text-gray-600">{(file.size / 1024 / 1024).toFixed(2)} MB</p>
                                </div>
                                <Button variant="ghost" size="sm" onClick={() => {
                                    setFile(null);
                                    setCalcResult(null);
                                    if(fileInputRef.current) fileInputRef.current.value = null;
                                }}>
                                    <IconX size={16} />
                                </Button>
                             </div>
                        )}
                    </CardContent>
                </Card>

                {/* 2. Krok - Nastaven칤 */}
                <Card>
                    <CardHeader>
                        <CardTitle className="text-2xl">2. Zvolte parametry tisku</CardTitle>
                        <CardDescription>Cena se automaticky p콏epo캜칤t치.</CardDescription>
                    </CardHeader>
                    <CardContent className="space-y-6">
                        {/* V칳b캩r materi치lu */}
                        <div>
                            <Label className="text-base font-medium">Materi치l</Label>
                            <RadioGroup value={material} onValueChange={setMaterial} name="material" className="mt-2">
                                <RadioGroupItem value="PLA" id="mat-pla">
                                    <div className="flex-1">
                                        <p className="font-medium">PLA (Standard)</p>
                                        <p className="text-sm text-gray-600">Pevn칳 a ekologick칳. Ide치ln칤 pro v캩t코inu model콢.</p>
                                    </div>
                                    {/* *** ZM캨NA: Cena upravena *** */}
                                    <span className="text-sm font-semibold">{PRICE_PER_GRAM_PLA.toFixed(2)} K캜/g</span>
                                </RadioGroupItem>
                                <RadioGroupItem value="PETG" id="mat-petg">
                                     <div className="flex-1">
                                        <p className="font-medium">PETG (Odoln칳)</p>
                                        <p className="text-sm text-gray-600">Vy코코칤 tepeln치 a mechanick치 odolnost.</p>
                                    </div>
                                    <span className="text-sm font-semibold">{PRICE_PER_GRAM_PETG.toFixed(2)} K캜/g</span>
                                </RadioGroupItem>
                            </RadioGroup>
                            
                            {/* *** NOVINKA: V칳b캩r barvy (pouze pro PLA) *** */}
                            {material === 'PLA' && (
                                <div className="pt-4 border-t mt-6">
                                    <Label className="text-base font-medium">Barva (PLA)</Label>
                                    <RadioGroup 
                                        value={color} 
                                        onValueChange={setColor} 
                                        name="color" 
                                        className="mt-2 grid grid-cols-2 sm:grid-cols-3 gap-2 !space-y-0"
                                    >
                                        {PLA_COLORS.map(c => (
                                            <RadioGroupItem key={c.id} value={c.id} id={`c-${c.id}`} className="p-2 !gap-2 justify-start">
                                                <div className="flex items-center gap-2">
                                                    <span 
                                                        className="h-5 w-5 rounded-full" 
                                                        style={{ 
                                                            background: c.hex === '#FFFFFF' ? '#FFF' : c.hex, 
                                                            border: c.hex === '#FFFFFF' ? '1px solid #ccc' : 'none' 
                                                        }}
                                                    ></span>
                                                    <span className="font-medium text-sm">{c.name}</span>
                                                </div>
                                            </RadioGroupItem>
                                        ))}
                                    </RadioGroup>
                                </div>
                            )}
                        </div>
                        
                        {/* *** ZM캨NA: V칳b캩r kvality upraven *** */}
                        <div>
                            <Label className="text-base font-medium">Kvalita (V칳코ka vrstvy)</Label>
                            <RadioGroup value={quality} onValueChange={(val) => setQuality(parseFloat(val))} name="quality" className="mt-2">
                                {/* ODSTRAN캨NO: 0.1 mm */}
                                <RadioGroupItem value={0.2} id="q-std">
                                    <p className="font-medium">Standardn칤 (0.2 mm)</p>
                                </RadioGroupItem>
                                {/* ODSTRAN캨NO: 0.3 mm */}
                                {/* P콎ID츼NO: 0.4 mm */}
                                <RadioGroupItem value={0.4} id="q-fast">
                                    <p className="font-medium">Rychl치 (0.4 mm)</p>
                                </RadioGroupItem>
                            </RadioGroup>
                        </div>
                    </CardContent>
                </Card>
            </div>
            
            {/* Prav치 strana - Kalkulace */}
            <div className="lg:sticky top-28 h-fit">
                <Card className="bg-gray-50/70 shadow-lg">
                    <CardHeader>
                        <CardTitle className="text-2xl">3. Cenov치 kalkulace</CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        
                        {/* Na캜칤t치n칤 nebo v칳sledek */}
                        {isCalculating ? (
                            <div className="flex flex-col items-center justify-center h-48">
                                <IconLoader size={48} className="text-black" />
                                <p className="mt-4 text-lg font-medium">Po캜칤t치m cenu...</p>
                            </div>
                        ) : !calcResult ? (
                            <div className="flex flex-col items-center justify-center h-48 text-center">
                                <IconCube size={48} className="text-gray-400" />
                                <p className="mt-4 text-lg text-gray-700">Pros칤m, nahrajte .stl soubor pro spu코t캩n칤 kalkulace.</p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span className="text-gray-700">P콏칤prava tisku (fixn칤):</span>
                                        <span className="font-medium">{PRICE_SETUP_FEE.toFixed(2)} K캜</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-700">Cena materi치lu ({material}):</span>
                                        <span className="font-medium">{calcResult.materialCost.toFixed(2)} K캜</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-700">Cena tiskov칠ho 캜asu:</span>
                                        <span className="font-medium">{calcResult.timeCost.toFixed(2)} K캜</span>
                                    </div>
                                </div>
                                <div className="border-t pt-4">
                                    <div className="flex justify-between text-2xl font-bold text-black">
                                        <span>Celkov치 cena:</span>
                                        <span>{calcResult.totalPrice.toFixed(2)} K캜</span>
                                    </div>
                                </div>
                                
                                <Button size="lg" className="w-full" onClick={handleAddToCart}>
                                    <IconShoppingBag size={18} className="mr-2" />
                                    Vlo쬴t do ko코칤ku
                                </Button>
                                
                                <div className="text-xs text-gray-600 space-y-1 pt-2">
                                    <p><strong>Soubor:</strong> {calcResult.fileName}</p>
                                    <p><strong>Odhadovan칳 objem:</strong> {calcResult.volumeCm3.toFixed(2)} cm췁</p>
                                    <p><strong>Odhadovan치 v치ha:</strong> {calcResult.weightG.toFixed(1)} g</p>
                                    <p><strong>Odhadovan칳 캜as:</strong> {calcResult.timeH.toFixed(1)} h</p>
                                </div>
                                <p className="text-xs text-gray-500 italic text-center">
                                    Toto je pouze odhad. Cena je fin치ln칤, ale 캜as tisku se m콢쬰 li코it.
                                </p>
                            </div>
                        )}
                        
                    </CardContent>
                </Card>
            </div>
            
        </div>
      </section>
    </React.Fragment>
  );
};


// --- HLAVN칈 KOMPONENTA APLIKACE ---

function App() {
  return (
    <AppProvider>
      <div className="flex min-h-screen flex-col bg-white text-black">
        <Header />
        
        <main className="flex-grow">
          <PageContent />
        </main>
        
        <Footer />
        <Toast />
      </div>
    </AppProvider>
  );
}

// Router
// *** UPRAVENO: P콏id치n 'case' pro 'customPrint' ***
const PageContent = () => {
  const { currentPage } = useAppContext();
  
  switch (currentPage) {
    case 'home':
      return <HomePage />;
    case 'product':
      return <ProductDetailPage />;
    case 'cart':
      return <CartPage />;
    // *** OPRAVA CHYBY: Odebr치na dvojte캜ka nav칤c ***
    case 'checkout':
      return <CheckoutPage />;
    case 'confirmation':
      return <ConfirmationPage />;
    case 'contact':
      return <ContactPage />;
    case 'printing':
      return <PrintingInfoPage />;
    // *** NOVINKA: Sm캩rov치n칤 na novou str치nku ***
    case 'customPrint':
        return <CustomPrintPage />;
    default:
      return <HomePage />;
  }
};

// --- RENDER APLIKACE ---
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

    </script>
</body>
</html>